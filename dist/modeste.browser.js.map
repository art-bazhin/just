{"version":3,"file":"modeste.browser.js","sources":["../src/constants.js","../src/utils.js","../src/error.js","../src/dom.js","../src/component.js","../src/vDom.js","../src/main.js"],"sourcesContent":["export const ROOT_NAME = 'modesteRoot';\nexport const INTERNAL_VAR_NAME = '__modesteInternal';\n","export function strictEqual(a, b) {\n  return a === b;\n}\n\nexport function shallowCompare(a, b) {\n  let aKeys = Object.keys(a);\n  let bKeys = Object.keys(b);\n\n  if (aKeys.length !== bKeys.length) return false;\n\n  for (let i = 0; i < aKeys.length; i++) {\n    let key = aKeys[i];\n    let index = bKeys.indexOf(key);\n\n    if (index < 0) return false;\n    if (!strictEqual(a[key], b[key])) return false;\n  }\n\n  return true;\n}\n\nexport function toKebabCase(str) {\n  return str.replace(/([A-Z])/g, '-$1').toLowerCase();\n}\n\nexport function generateId(maxValue, store, middleware) {\n  let id;\n\n  do {\n    id = (Math.random() * maxValue).toFixed(0);\n    if (middleware) id = middleware(id);\n  } while (store[id]);\n\n  store[id] = true;\n\n  return id;\n}\n","export default class ModesteError extends Error {\n  constructor(...args) {\n    super(...args);\n    this.name = 'MODESTE Error';\n    this.message = '[MODESTE ERROR] ' + this.message;\n    Error.captureStackTrace(this, modesteError);\n  }\n}\n","import { toKebabCase } from './utils';\nimport { INTERNAL_VAR_NAME as m } from './constants';\nimport { render, setProps, removeChild } from './component';\n\nimport ModesteError from './error';\n\nexport function addStyles(style, scope) {\n  if (!style) return;\n\n  let styleElement = document.createElement('style');\n\n  let regex = /:\\$/gm;\n  let repl = '.' + scope;\n\n  styleElement.textContent = style.replace(regex, repl);\n\n  document.head.appendChild(styleElement);\n\n  return styleElement;\n}\n\nexport function createDom(vDom, parent) {\n  if (!vDom) {\n    return document.createComment('');\n  }\n\n  switch (typeof vDom) {\n    case 'string':\n      return document.createTextNode(vDom);\n\n    case 'object':\n      prepareVDom(vDom, parent[m].scope);\n\n      if (vDom.component) {\n        let component = createComponent(vDom.component, vDom.props, parent);\n\n        if (vDom.ref) vDom.ref(component);\n\n        render(component);\n        return component[m].dom;\n      }\n\n      let dom = document.createElement(vDom.tag);\n\n      dom[m] = {};\n      dom[m].attrs = {};\n      dom[m].props = {};\n\n      Object.keys(vDom.attrs).forEach(attr => {\n        if (vDom.attrs[attr] !== null) {\n          dom.setAttribute(attr, vDom.attrs[attr]);\n          dom[m].attrs[attr] = vDom.attrs[attr];\n        }\n      });\n\n      Object.keys(vDom.props).forEach(prop => {\n        if (vDom.props[prop] !== null) {\n          dom[prop] = vDom.props[prop];\n          dom[m].props[prop] = vDom.props[prop];\n        }\n      });\n\n      vDom.children.forEach(child => {\n        testVDom(child, parent);\n        dom.appendChild(createDom(child, parent));\n      });\n\n      if (vDom.ref) vDom.ref(dom);\n\n      return dom;\n  }\n}\n\nexport function updateDom(dom, vDom, parent) {\n  prepareVDom(vDom, parent[m].scope);\n\n  if (vDom && vDom.component) {\n    updateComponentDom(dom, vDom, parent);\n    return;\n  }\n\n  if (!sameTypeAndTag(dom, vDom)) {\n    if (dom[m] && dom[m].id) {\n      removeChild(parent, dom[m].id);\n    }\n\n    let newDom = createDom(vDom, parent);\n    dom.parentNode.replaceChild(newDom, dom);\n\n    if (parent[m].dom === dom) {\n      parent[m].dom = newDom;\n    }\n\n    return;\n  }\n\n  switch (dom.nodeType) {\n    case 1:\n      // Process attrs\n      let attrs = [];\n\n      if (dom[m].attrs) {\n        Object.keys(dom[m].attrs).forEach(attr => {\n          attrs.push(attr);\n        });\n      }\n\n      if (!dom[m].attrs) dom[m].attrs = {};\n\n      Object.keys(vDom.attrs).forEach(attr => {\n        if (vDom.attrs[attr] === null) {\n          dom.removeAttribute(attr);\n          delete dom[m].attrs[attr];\n        } else if (dom[attr] !== vDom.attrs[attr]) {\n          dom.setAttribute(attr, vDom.attrs[attr]);\n          dom[m].attrs[attr] = vDom.attrs[attr];\n        }\n\n        let index = attrs.indexOf(attr);\n        if (index > -1) {\n          attrs.splice(index, 1);\n        }\n      });\n\n      attrs.forEach(attr => {\n        dom.removeAttribute(attr);\n        delete dom[m].attrs[attr];\n      });\n\n      // Process props\n      let props = [];\n\n      if (dom[m].props) {\n        Object.keys(dom[m].props).forEach(prop => {\n          props.push(prop);\n        });\n      }\n\n      if (!dom[m].props) dom[m].props = {};\n\n      Object.keys(vDom.props).forEach(prop => {\n        if (vDom.props[prop] === null) {\n          dom[prop] = null;\n          delete dom[m].props[prop];\n        } else if (dom[prop] !== vDom.props[prop]) {\n          dom[prop] = vDom.props[prop];\n          dom[m].props[prop] = vDom.props[prop];\n        }\n\n        let index = props.indexOf(prop);\n        if (index > -1) {\n          props.splice(index, 1);\n        }\n      });\n\n      props.forEach(prop => {\n        dom[prop] = null;\n        delete dom[m].props[prop];\n      });\n\n      // Process child nodes\n      if (!vDom.children) vDom.children = [];\n\n      vDom.children.forEach((child, index) => {\n        testVDom(child, parent);\n\n        if (!dom.childNodes[index]) {\n          dom.appendChild(createDom(child, parent));\n        } else {\n          updateDom(dom.childNodes[index], child, parent);\n        }\n      });\n\n      while (dom.childNodes[vDom.children.length]) {\n        let child = dom.childNodes[vDom.children.length];\n        dom.removeChild(child);\n      }\n\n      // Run ref function\n      if (vDom.ref) vDom.ref(dom);\n\n      break;\n\n    case 3:\n      if (dom.nodeValue !== vDom) {\n        dom.nodeValue = vDom;\n      }\n      break;\n  }\n}\n\nfunction updateComponentDom(dom, vDom, parent) {\n  if (dom[m] && dom[m].id) {\n    let id = dom[m].id;\n    let component = parent[m].children[id];\n\n    if (!vDom.props) vDom.props = {};\n\n    if (component[m].name === vDom.component) {\n      component[m].dom = dom;\n      setProps(component, vDom.props);\n\n      if (vDom.ref) vDom.ref(component);\n      return;\n    } else parent[m].removeChild(id);\n  }\n\n  let component = createComponent(vDom.component, vDom.props, parent);\n  component[m].dom = dom;\n\n  if (vDom.ref) vDom.ref(component);\n\n  render(component);\n}\n\nfunction createComponent(name, props, parent) {\n  if (parent[m].factories[name]) {\n    return parent[m].factories[name](props, parent);\n  }\n\n  return parent[m].app.factories[name](props, parent);\n}\n\nfunction sameTypeAndTag(dom, vDom) {\n  if (!vDom) return dom.nodeType === 8;\n\n  if (typeof vDom === 'object' && dom.nodeType === 1) {\n    return vDom.tag.toUpperCase() === dom.tagName;\n  } else if (typeof vDom === 'string' && dom.nodeType === 3) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction prepareVDom(vDom, scope) {\n  if (!vDom || typeof vDom === 'string') return;\n  if (!vDom.children) vDom.children = [];\n  if (!vDom.props) vDom.props = {};\n\n  if (!vDom.component) {\n    if (!vDom.attrs) vDom.attrs = {};\n    else {\n      let kebabAttrs = {};\n\n      Object.keys(vDom.attrs).forEach(attr => {\n        kebabAttrs[toKebabCase(attr)] = vDom.attrs[attr];\n      });\n\n      vDom.attrs = kebabAttrs;\n    }\n\n    if (vDom.props.className) {\n      delete vDom.attrs.class;\n      vDom.props.className = scope + ' ' + vDom.props.className;\n    } else {\n      if (!vDom.attrs.class) vDom.props.className = scope;\n      else vDom.attrs.class = scope + ' ' + vDom.attrs.class;\n    }\n  }\n}\n\nfunction testVDom(vDom, parent) {\n  if (!vDom) return;\n\n  if (typeof vDom !== 'string' && !vDom.tag && !vDom.component) {\n    throw new ModesteError(\n      `${\n        parent[m].name\n      }: VDOM node must be a string or an object with \"tag\" or \"component\" property`\n    );\n  }\n\n  if (vDom.children && !(vDom.children instanceof Array)) {\n    throw new ModesteError(\n      `${parent[m].name}: VDOM node \"children\" property must be an Array`\n    );\n  }\n}\n","import { createDom, updateDom, addStyles } from './dom';\nimport { tag as t, component as c } from './vDom';\nimport { shallowCompare, strictEqual, generateId } from './utils';\nimport { INTERNAL_VAR_NAME as m } from './constants';\nimport ModesteError from './error';\n\nconst HOOKS = [\n  'willCreate',\n  'didCreate',\n  'willMount',\n  'didMount',\n  'willUpdate',\n  'didUpdate',\n  'willRemove',\n  'didRemove',\n  'shouldUpdateData',\n  'shouldUpdateProps'\n];\n\nlet scopes = {};\n\nexport default function Component(opts, app) {\n  this[m] = {};\n\n  if (!opts.manifest.factories) opts.manifest.factories = {};\n\n  this[m].factories = opts.manifest.factories;\n  this[m].app = app ? app : this;\n  this[m].name = opts.name;\n  this[m].id = opts.id;\n  this[m].scope = opts.scope;\n  this[m].children = {};\n\n  this[m].render = opts.manifest.render.bind(this);\n  this[m].shouldUpdateData = shouldUpdateData;\n  this[m].shouldUpdateProps = shouldUpdateProps;\n\n  registerHooks(this, opts.manifest);\n  emitHook(this, 'willCreate');\n\n  this.props = opts.props ? opts.props : {};\n\n  if (opts.manifest.data) {\n    this[m].data = opts.manifest.data();\n\n    Object.keys(this[m].data).forEach(prop =>\n      Object.defineProperty(this, prop, {\n        enumerable: true,\n        get: function() {\n          return this[m].data[prop];\n        },\n        set: function(value) {\n          if (this[m].shouldUpdateData(this[m].data[prop], value)) {\n            this[m].data[prop] = value;\n            render(this);\n          }\n        }\n      })\n    );\n  }\n\n  if (opts.manifest.components) {\n    Object.keys(opts.manifest.components).forEach(name => {\n      registerComponent(this, name, opts.manifest.components[name]);\n    });\n  }\n\n  if (opts.manifest.methods) {\n    Object.keys(opts.manifest.methods).forEach(method => {\n      this[method] = opts.manifest.methods[method].bind(this);\n    });\n  }\n\n  emitHook(this, 'didCreate');\n}\n\nComponent.prototype.render = function() {\n  render(this);\n};\n\nexport function generateScope(name) {\n  return generateId(1000000, scopes, id => name + id);\n}\n\nexport function render(component) {\n  let isMounting = !component[m].dom;\n\n  if (isMounting) emitHook(component, 'willMount');\n  else emitHook(component, 'willUpdate');\n\n  let vDom = component[m].render(t, c);\n\n  if (typeof vDom !== 'object' || vDom.component || !vDom.tag) {\n    throw new ModesteError(\n      `${component[m].name}: Component root must be a tag`\n    );\n  }\n\n  if (isMounting) {\n    component[m].dom = createDom(vDom, component, true);\n  } else {\n    updateDom(component[m].dom, vDom, component, true);\n  }\n\n  component[m].dom[m].id = component[m].id;\n\n  if (isMounting) emitHook(component, 'didMount');\n  else emitHook(component, 'didUpdate');\n}\n\nexport function setProps(component, props) {\n  if (component[m].shouldUpdateProps(component.props, props)) {\n    component.props = props;\n    render(component);\n  }\n}\n\nexport function removeChild(parent, id) {\n  if (parent[m].children[id]) {\n    let component = parent[m].children[id];\n\n    emitHook(component, 'willRemove');\n    delete component[m].dom;\n\n    Object.keys(component[m].children).forEach(id => {\n      removeChild(id, component);\n    });\n\n    emitHook(component, 'didRemove');\n    delete parent[m].children[id];\n  }\n}\n\nfunction registerHooks(component, manifest) {\n  HOOKS.forEach(hook => {\n    if (manifest[hook]) component[m][hook] = manifest[hook].bind(component);\n  });\n}\n\nfunction emitHook(component, hook) {\n  if (component[m][hook]) component[m][hook]();\n}\n\nfunction registerComponent(parent, name, manifest) {\n  if (!parent[m].factories[name]) {\n    let scope = generateScope(name);\n\n    addStyles(manifest.style(), scope);\n\n    parent[m].factories[name] = (props, parent) => {\n      let id = generateId(1000000, parent[m].children);\n\n      let component = new Component(\n        {\n          name,\n          manifest,\n          scope,\n          id,\n          props\n        },\n        parent[m].app\n      );\n\n      parent[m].children[id] = component;\n\n      return component;\n    };\n  }\n}\n\nfunction shouldUpdateData(oldValue, newValue) {\n  return !strictEqual(oldValue, newValue);\n}\n\nfunction shouldUpdateProps(oldProps, newProps) {\n  !shallowCompare(oldProps, newProps);\n}\n","export function tag(tag, opts, children) {\n  let props = {};\n  let attrs = {};\n  let node = { tag, props, attrs, children };\n\n  if (opts) {\n    Object.keys(opts).forEach(key => {\n      switch (key[0]) {\n        case '_':\n          attrs[key.substr(1)] = opts[key];\n          break;\n        case '$':\n          node[key.substr(1)] = opts[key];\n          break;\n        default:\n          props[key] = opts[key];\n      }\n    });\n  }\n\n  return node;\n}\n\nexport function component(component, opts) {\n  let props = {};\n  let node = { component, props };\n\n  if (opts) {\n    Object.keys(opts).forEach(key => {\n      switch (key[0]) {\n        case '$':\n          node[key.substr(1)] = opts[key];\n          break;\n        default:\n          props[key] = opts[key];\n      }\n    });\n  }\n\n  return node;\n}\n","import { ROOT_NAME, INTERNAL_VAR_NAME as m } from './constants';\nimport { generateScope } from './component';\nimport { addStyles } from './dom';\nimport Component from './component';\n\nlet scope = generateScope(ROOT_NAME);\n\nexport default function Modeste(manifest) {\n  Component.call(this, {\n    name: ROOT_NAME,\n    id: ROOT_NAME,\n    manifest,\n    scope\n  });\n\n  if (manifest.style) addStyles(manifest.style(), scope);\n  this[m].wrap = document.querySelector(manifest.selector);\n}\n\nModeste.prototype = Object.create(Component.prototype);\nModeste.prototype.constructor = Modeste;\n\nModeste.prototype.render = function() {\n  Component.prototype.render.call(this);\n\n  if (this[m].wrap.childNodes.length === 0) {\n    this[m].wrap.appendChild(this[m].dom);\n  }\n};\n"],"names":["ROOT_NAME","INTERNAL_VAR_NAME","strictEqual","a","b","generateId","maxValue","store","middleware","id","Math","random","toFixed","ModesteError","args","name","message","_this","captureStackTrace","modesteError","Error","addStyles","style","scope","styleElement","document","createElement","repl","textContent","replace","head","appendChild","createDom","vDom","parent","createComment","createTextNode","m","component","createComponent","props","ref","dom","tag","attrs","keys","forEach","attr","setAttribute","prop","children","child","updateDom","shouldUpdateProps","removeChild","nodeType","toUpperCase","tagName","sameTypeAndTag","newDom","parentNode","replaceChild","push","removeAttribute","index","indexOf","splice","childNodes","length","nodeValue","factories","app","prepareVDom","kebabAttrs","str","toLowerCase","className","class","testVDom","Array","opts","node","key","substr","HOOKS","scopes","Component","manifest","this","render","bind","shouldUpdateData","hook","data","Object","defineProperty","value","components","generateScope","methods","method","isMounting","emitHook","t","c","oldValue","newValue","oldProps","newProps","aKeys","bKeys","i","shallowCompare","prototype","Modeste","call","wrap","querySelector","selector","create","constructor"],"mappings":"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"}