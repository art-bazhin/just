{"version":3,"file":"modeste.js","sources":["../src/utils.js","../src/constants.js","../src/error.js","../src/dom.js","../src/component.js","../src/main.js"],"sourcesContent":["export function strictEqual(a, b) {\n  return a === b;\n}\n\nexport function shallowCompare(a, b) {\n  let aKeys = Object.keys(a);\n  let bKeys = Object.keys(b);\n\n  if (aKeys.length !== bKeys.length) return false;\n\n  for (let i = 0; i < aKeys.length; i++) {\n    let key = aKeys[i];\n    let index = bKeys.indexOf(key);\n\n    if (index < 0) return false;\n    if (!strictEqual(a[key], b[key])) return false;\n  }\n\n  return true;\n}\n\nexport function processStyle(style, scope) {\n  if (!style) return;\n\n  let styleElement = document.createElement('style');\n\n  let regex = /:scoped/gm;\n  let repl = '.' + scope;\n\n  let rootRegex = /:component/gm;\n  let rootRepl = '.' + getScopeRoot(scope);\n\n  styleElement.textContent = style\n    .replace(regex, repl)\n    .replace(rootRegex, rootRepl);\n\n  document.head.appendChild(styleElement);\n\n  return styleElement;\n}\n\nexport function toKebabCase(str) {\n  return str.replace(/([A-Z])/g, '-$1').toLowerCase();\n}\n\nexport function getScopeRoot(scope) {\n  return '_' + scope;\n}\n\nexport function generateId(maxValue, store, middleware) {\n  let id;\n\n  do {\n    id = (Math.random() * maxValue).toFixed(0);\n    if (middleware) id = middleware(id);\n  } while (store[id]);\n\n  store[id] = true;\n\n  return id;\n}\n","export const ROOT_NAME = 'modesteRoot';\nexport const INTERNAL_VAR_NAME = '__modesteInternal';\n","export default class ModesteError extends Error {\n  constructor(...args) {\n    super(...args);\n    this.name = 'MODESTE Error';\n    this.message = '[MODESTE ERROR] ' + this.message;\n    Error.captureStackTrace(this, modesteError);\n  }\n}\n","import { getScopeRoot, toKebabCase } from './utils';\nimport { INTERNAL_VAR_NAME as m } from './constants';\nimport { render, setProps, removeChild } from './component';\n\nimport ModesteError from './error';\n\nexport function createDom(vDom, parent, isComponentRoot) {\n  if (!vDom) {\n    return document.createComment('');\n  }\n\n  switch (typeof vDom) {\n    case 'string':\n      return document.createTextNode(vDom);\n\n    case 'object':\n      prepareVDom(vDom, parent[m].scope, isComponentRoot);\n\n      if (vDom.component) {\n        let component = createComponent(vDom.component, vDom.props, parent);\n\n        if (vDom.ref) vDom.ref(component);\n\n        render(component);\n        return component[m].dom;\n      }\n\n      let dom = document.createElement(vDom.tag);\n\n      dom[m] = {};\n      dom[m].attrs = {};\n      dom[m].props = {};\n\n      Object.keys(vDom.attrs).forEach(attr => {\n        if (vDom.attrs[attr] !== null) {\n          dom.setAttribute(attr, vDom.attrs[attr]);\n          dom[m].attrs[attr] = vDom.attrs[attr];\n        }\n      });\n\n      Object.keys(vDom.props).forEach(prop => {\n        if (vDom.props[prop] !== null) {\n          dom[prop] = vDom.props[prop];\n          dom[m].props[prop] = vDom.props[prop];\n        }\n      });\n\n      vDom.children.forEach(child => {\n        testVDom(child, parent);\n        dom.appendChild(createDom(child, parent));\n      });\n\n      if (vDom.ref) vDom.ref(dom);\n\n      return dom;\n  }\n}\n\nexport function updateDom(dom, vDom, parent, isComponentRoot) {\n  prepareVDom(vDom, parent[m].scope, isComponentRoot);\n\n  if (vDom && vDom.component) {\n    updateComponentDom(dom, vDom, parent);\n    return;\n  }\n\n  if (!sameTypeAndTag(dom, vDom)) {\n    if (dom[m] && dom[m].id) {\n      removeChild(parent[m], dom[m].id);\n    }\n\n    let newDom = createDom(vDom, parent);\n    dom.parentNode.replaceChild(newDom, dom);\n\n    if (parent[m].dom === dom) {\n      parent[m].dom = newDom;\n    }\n\n    return;\n  }\n\n  switch (dom.nodeType) {\n    case 1:\n      // Process attrs\n      let attrs = [];\n\n      if (dom[m].attrs) {\n        Object.keys(dom[m].attrs).forEach(attr => {\n          attrs.push(attr);\n        });\n      }\n\n      if (!dom[m].attrs) dom[m].attrs = {};\n\n      Object.keys(vDom.attrs).forEach(attr => {\n        if (vDom.attrs[attr] === null) {\n          dom.removeAttribute(attr);\n          delete dom[m].attrs[attr];\n        } else if (dom[attr] !== vDom.attrs[attr]) {\n          dom.setAttribute(attr, vDom.attrs[attr]);\n          dom[m].attrs[attr] = vDom.attrs[attr];\n        }\n\n        let index = attrs.indexOf(attr);\n        if (index > -1) {\n          attrs.splice(index, 1);\n        }\n      });\n\n      attrs.forEach(attr => {\n        dom.removeAttribute(attr);\n        delete dom[m].attrs[attr];\n      });\n\n      // Process props\n      let props = [];\n\n      if (dom[m].props) {\n        Object.keys(dom[m].props).forEach(prop => {\n          props.push(prop);\n        });\n      }\n\n      if (!dom[m].props) dom[m].props = {};\n\n      Object.keys(vDom.props).forEach(prop => {\n        if (vDom.props[prop] === null) {\n          dom[prop] = null;\n          delete dom[m].props[prop];\n        } else if (dom[prop] !== vDom.props[prop]) {\n          dom[prop] = vDom.props[prop];\n          dom[m].props[prop] = vDom.props[prop];\n        }\n\n        let index = props.indexOf(prop);\n        if (index > -1) {\n          props.splice(index, 1);\n        }\n      });\n\n      props.forEach(prop => {\n        dom[prop] = null;\n        delete dom[m].props[prop];\n      });\n\n      // Process child nodes\n      if (!vDom.children) vDom.children = [];\n\n      vDom.children.forEach((child, index) => {\n        testVDom(child, parent);\n\n        if (!dom.childNodes[index]) {\n          dom.appendChild(createDom(child, parent));\n        } else {\n          updateDom(dom.childNodes[index], child, parent);\n        }\n      });\n\n      while (dom.childNodes[vDom.children.length]) {\n        let child = dom.childNodes[vDom.children.length];\n        dom.removeChild(child);\n      }\n\n      // Run ref function\n      if (vDom.ref) vDom.ref(dom);\n\n      break;\n\n    case 3:\n      if (dom.nodeValue !== vDom) {\n        dom.nodeValue = vDom;\n      }\n      break;\n  }\n}\n\nfunction updateComponentDom(dom, vDom, parent) {\n  if (dom[m].id) {\n    let id = dom[m].id;\n    let component = parent[m].children[id];\n\n    if (!vDom.props) vDom.props = {};\n\n    if (component[m].name === vDom.component) {\n      component[m].dom = dom;\n      setProps(component, vDom.props);\n\n      if (vDom.ref) vDom.ref(component);\n      return;\n    } else parent[m].removeChild(id);\n  }\n\n  let component = createComponent(vDom.component, vDom.props, parent);\n  component[m].dom = dom;\n\n  if (vDom.ref) vDom.ref(component);\n\n  render(component);\n}\n\nfunction createComponent(name, props, parent) {\n  if (parent[m].factories[name]) {\n    return parent[m].factories[name](props, parent);\n  }\n\n  return parent[m].app.factories[name](props, parent);\n}\n\nfunction sameTypeAndTag(dom, vDom) {\n  if (!vDom) return dom.nodeType === 8;\n\n  if (typeof vDom === 'object' && dom.nodeType === 1) {\n    return vDom.tag.toUpperCase() === dom.tagName;\n  } else if (typeof vDom === 'string' && dom.nodeType === 3) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction prepareVDom(vDom, scope, isComponentRoot) {\n  if (!vDom || typeof vDom === 'string') return;\n  if (!vDom.children) vDom.children = [];\n  if (!vDom.props) vDom.props = {};\n\n  if (!vDom.component) {\n    if (!vDom.attrs) vDom.attrs = {};\n    else {\n      let kebabAttrs = {};\n\n      Object.keys(vDom.attrs).forEach(attr => {\n        kebabAttrs[toKebabCase(attr)] = vDom.attrs[attr];\n      });\n\n      vDom.attrs = kebabAttrs;\n    }\n\n    let scopeClass = isComponentRoot ? getScopeRoot(scope) : scope;\n\n    if (vDom.props.className) {\n      delete vDom.attrs.class;\n      vDom.props.className = scopeClass + ' ' + vDom.props.className;\n    } else {\n      if (!vDom.attrs.class) vDom.props.className = scopeClass;\n      else vDom.attrs.class = scopeClass + ' ' + vDom.attrs.class;\n    }\n  }\n}\n\nfunction testVDom(vDom, parent) {\n  if (!vDom) return;\n\n  if (typeof vDom !== 'string' && !vDom.tag && !vDom.component) {\n    throw new ModesteError(\n      `${\n        parent[m].name\n      }: VDOM node must be a string or an object with \"tag\" or \"component\" property`\n    );\n  }\n\n  if (vDom.children && !(vDom.children instanceof Array)) {\n    throw new ModesteError(\n      `${parent[m].name}: VDOM node \"children\" property must be an Array`\n    );\n  }\n}\n","import { createDom, updateDom } from './dom';\nimport { processStyle, shallowCompare, strictEqual, generateId } from './utils';\nimport { INTERNAL_VAR_NAME as m } from './constants';\nimport ModesteError from './error';\n\nconst HOOKS = [\n  'willCreate',\n  'didCreate',\n  'willMount',\n  'didMount',\n  'willUpdate',\n  'didUpdate',\n  'willRemove',\n  'didRemove',\n  'shouldUpdateData',\n  'shouldUpdateProps'\n];\n\nlet scopes = {};\n\nexport default function Component(opts, app) {\n  this[m] = {};\n\n  if (!opts.manifest.factories) opts.manifest.factories = {};\n\n  this[m].factories = opts.manifest.factories;\n  this[m].app = app ? app : this;\n  this[m].name = opts.name;\n  this[m].id = opts.id;\n  this[m].scope = opts.scope;\n  this[m].children = {};\n\n  this[m].render = opts.manifest.render.bind(this);\n  this[m].shouldUpdateData = shouldUpdateData;\n  this[m].shouldUpdateProps = shouldUpdateProps;\n\n  registerHooks(this, opts.manifest);\n  emitHook(this, 'willCreate');\n\n  this.props = opts.props ? opts.props : {};\n\n  if (opts.manifest.data) {\n    this[m].data = opts.manifest.data();\n\n    Object.keys(this[m].data).forEach(prop =>\n      Object.defineProperty(this, prop, {\n        enumerable: true,\n        get: function() {\n          return this[m].data[prop];\n        },\n        set: function(value) {\n          if (this[m].shouldUpdateData(this[m].data[prop], value)) {\n            this[m].data[prop] = value;\n            render(this);\n          }\n        }\n      })\n    );\n  }\n\n  if (opts.manifest.components) {\n    Object.keys(opts.manifest.components).forEach(name => {\n      registerComponent(this, name, opts.manifest.components[name]);\n    });\n  }\n\n  if (opts.manifest.methods) {\n    Object.keys(opts.manifest.methods).forEach(method => {\n      this[method] = opts.manifest.methods[method].bind(this);\n    });\n  }\n\n  emitHook(this, 'didCreate');\n}\n\nComponent.prototype.render = function() {\n  render(this);\n};\n\nexport function generateScope(name) {\n  return generateId(10000, scopes, id => name + id);\n}\n\nexport function render(component) {\n  let isMounting = !component[m].dom;\n\n  if (isMounting) emitHook(component, 'willMount');\n  else emitHook(component, 'willUpdate');\n\n  let vDom = component[m].render();\n\n  if (typeof vDom !== 'object' || vDom.component || !vDom.tag) {\n    throw new ModesteError(\n      `${component[m].name}: Component root must be a tag`\n    );\n  }\n\n  if (isMounting) {\n    component[m].dom = createDom(vDom, component, true);\n  } else {\n    updateDom(component[m].dom, vDom, component, true);\n  }\n\n  component[m].dom[m].id = component[m].id;\n\n  if (isMounting) emitHook(component, 'didMount');\n  else emitHook(component, 'didUpdate');\n}\n\nexport function setProps(component, props) {\n  if (component[m].shouldUpdateProps(component.props, props)) {\n    component.props = props;\n    render(component);\n  }\n}\n\nexport function removeChild(parent, id) {\n  if (parent[m].children[id]) {\n    let component = this[m].children[id];\n\n    emitHook(component, 'willRemove');\n    delete component[m].dom;\n\n    Object.keys(component[m].children).forEach(id => {\n      removeChild(id, component);\n    });\n\n    emitHook(component, 'didRemove');\n    delete parent[m].children[id];\n  }\n}\n\nfunction registerHooks(component, manifest) {\n  HOOKS.forEach(hook => {\n    if (manifest[hook]) component[m][hook] = manifest[hook].bind(component);\n  });\n}\n\nfunction emitHook(component, hook) {\n  if (component[m][hook]) component[m][hook]();\n}\n\nfunction registerComponent(parent, name, manifest) {\n  if (!parent[m].factories[name]) {\n    let scope = generateScope(name);\n\n    processStyle(manifest.style(), scope);\n\n    parent[m].factories[name] = (props, parent) => {\n      let id = generateId(10000, parent[m].children);\n\n      let component = new Component(\n        {\n          name,\n          manifest,\n          scope,\n          id,\n          props\n        },\n        parent[m].app\n      );\n\n      parent[m].children[id] = component;\n\n      return component;\n    };\n  }\n}\n\nfunction shouldUpdateData(oldValue, newValue) {\n  return !strictEqual(oldValue, newValue);\n}\n\nfunction shouldUpdateProps(oldProps, newProps) {\n  !shallowCompare(oldProps, newProps);\n}\n","import { processStyle } from './utils';\nimport { ROOT_NAME, INTERNAL_VAR_NAME as m } from './constants';\nimport { generateScope } from './component';\nimport Component from './component';\n\nlet scope = generateScope(ROOT_NAME);\n\nexport default function Modeste(manifest) {\n  Component.call(this, {\n    name: ROOT_NAME,\n    id: ROOT_NAME,\n    manifest,\n    scope\n  });\n\n  if (manifest.style) processStyle(manifest.style(), scope);\n  this[m].wrap = document.querySelector(manifest.selector);\n}\n\nModeste.prototype = Object.create(Component.prototype);\nModeste.prototype.constructor = Modeste;\n\nModeste.prototype.render = function() {\n  Component.prototype.render.call(this);\n\n  if (this[m].wrap.childNodes.length === 0) {\n    this[m].wrap.appendChild(this[m].dom);\n  }\n};\n"],"names":["strictEqual","a","b","processStyle","style","scope","styleElement","document","createElement","repl","rootRepl","getScopeRoot","textContent","replace","head","appendChild","generateId","maxValue","store","middleware","id","Math","random","toFixed","ROOT_NAME","INTERNAL_VAR_NAME","ModesteError","args","name","message","_this","captureStackTrace","modesteError","Error","createDom","vDom","parent","isComponentRoot","createComment","createTextNode","m","component","createComponent","props","ref","dom","tag","attrs","keys","forEach","attr","setAttribute","prop","children","child","updateDom","shouldUpdateProps","removeChild","nodeType","toUpperCase","tagName","sameTypeAndTag","this","newDom","parentNode","replaceChild","push","removeAttribute","index","indexOf","splice","childNodes","length","nodeValue","factories","app","prepareVDom","kebabAttrs","str","toLowerCase","scopeClass","className","class","testVDom","Array","HOOKS","scopes","Component","opts","manifest","render","bind","shouldUpdateData","hook","data","Object","defineProperty","value","components","generateScope","methods","method","isMounting","emitHook","oldValue","newValue","oldProps","newProps","aKeys","bKeys","i","key","shallowCompare","prototype","Modeste","call","wrap","querySelector","selector","create","constructor"],"mappings":"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"}