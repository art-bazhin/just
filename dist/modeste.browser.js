var Modeste=function(){"use strict";var p="__modesteInternal",f=window.Node.COMMENT_NODE,l=window.Node.ELEMENT_NODE,h=window.Node.TEXT_NODE;function d(e,t){return e!==t}function y(e,t){return!function(e,t){var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var o=0;o<r.length;o++){var i=r[o];if(n.indexOf(i)<0)return!1;if(e[i]!==t[i])return!1}return!0}(e,t)}var m=["willCreate","didCreate","willMount","didMount","willUpdate","didUpdate","willRemove","didRemove","shouldUpdateData","shouldUpdateProps"];function b(e,t){e[p][t]&&e[p][t]()}function v(e,t){if(e){var r=document.createElement("style");if(t){var n="."+t+"$1";r.textContent=e.replace(/:scoped([^\w\d])/gm,n)}else r.textContent=e;return document.head.appendChild(r),r}}var n=8,o=0;function k(e){var t=Math.random().toString(36).substr(2,n),r=t+"0".repeat(n-t.length)+(o++).toString(36);return e?e(r):r}function E(e){return"__"+e+"__"}var w={};function r(e,n,t){var o={},i={},s={tag:e,props:o,attrs:i};return n&&(n instanceof Array?t=n:Object.keys(n).forEach(function(e){switch(e[0]){case"_":i[(t=e.substr(1),r=t.replace(/([A-Z])/g,"-$1").toLowerCase(),"-"===r[0]?r.substr(1):r)]=n[e];break;case"$":s[e.substr(1)]=n[e];break;default:o[e]=n[e]}var t,r})),s.children=t||[],s}function i(e,t){var r={},n={component:e,props:r};return t&&Object.keys(t).forEach(function(e){switch(e[0]){case"$":n[e.substr(1)]=t[e];break;default:r[e]=t[e]}}),n}function O(e,t){e&&"string"!=typeof e&&!e.component&&t&&(e.props.className||(e.props.className=""),e.attrs.class||(e.attrs.class=""),e.props.className=(e.props.className+" "+t).trim(),e.attrs.class=(e.attrs.class+" "+t).trim())}function g(e,t,r){return r[p].factories[e](e,t,r)}function j(e){var t=e[p].children;Object.keys(t).forEach(function(e){return j(t[e])}),e[p].mounted=!0,b(e,"didMount")}var C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t};function P(t,r){if(r&&O(t,r[p].scope),!t)return document.createComment("");switch(void 0===t?"undefined":C(t)){case"string":return document.createTextNode(t);case"object":if(t.component){var e=g(t.component,t.props,r);return t.ref&&t.ref(e),U(e),t.key&&(e[p].dom[p].key=t.key),e[p].dom}var n=document.createElement(t.tag);return n[p]={},n[p].attrs={},n[p].props={},Object.keys(t.attrs).forEach(function(e){null!==t.attrs[e]&&(n.setAttribute(e,t.attrs[e]),n[p].attrs[e]=t.attrs[e])}),Object.keys(t.props).forEach(function(e){null!==t.props[e]&&(n[e]=t.props[e],n[p].props[e]=t.props[e])}),t.children.forEach(function(e){var t=P(e,r);n.appendChild(t),r&&r[p].mounted&&t[p]&&t[p].id&&j(r[p].children[t[p].id])}),t.ref&&t.ref(n),t.key&&(n[p].key=t.key),n}}function N(){for(var r=arguments,e=function(t){Object.keys(r[t]).forEach(function(e){r[0][e]=r[t][e]})},t=1;t<arguments.length;t++)e(t);return arguments[0]}function T(e,t){var r=e[p].defaultProps?N({},e[p].defaultProps,t):t;e[p].shouldUpdateProps(e[p].props,r)&&(e[p].props=r,U(e))}function $(e){b(e,"willRemove");var t=e[p].parent,r=e[p].id;Object.keys(e[p].children).forEach(function(e){$(e)}),e[p].subscriptions.forEach(function(e){var t=e.store;e.fields.forEach(function(e){t[p].data.hasOwnProperty(e)&&delete t[p].subscribers[e][r]})}),e[p].mounted=!1,delete e[p].dom,t&&delete t[p].children[r],b(e,"didRemove")}function S(n,r,o){if(r&&r.component)!function(e,t,r){if(e[p]&&e[p].id){var n=e[p].id,o=r[p].children[n];if(o[p].name===t.component)return o[p].dom=e,T(o,t.props),t.ref&&t.ref(o),t.key?o[p].dom[p].key=t.key:o[p].dom[p].key&&delete o[p].dom[p].key;console.log(o[p].name,t.component),$(r[p].children[n])}var i=g(t.component,t.props,r);i[p].dom=e,t.ref&&t.ref(i),U(i),t.key?i[p].dom[p].key=t.key:i[p].dom[p].key&&delete i[p].dom[p].key,r[p].mounted&&j(i)}(n,r,o);else{if(t=n,!((i=r)?"object"===(void 0===i?"undefined":C(i))&&t.nodeType===l?i.tag.toUpperCase()===t.tagName:"string"==typeof i&&t.nodeType===h:t.nodeType===f)){n[p]&&n[p].id&&$(o[p].children[n[p].id]);var e=P(r,o);return n.parentNode.replaceChild(e,n),void(o[p].dom===n&&(o[p].dom=e))}var t,i;switch(O(r,o[p].scope),n.nodeType){case l:var s=[];n[p].attrs&&Object.keys(n[p].attrs).forEach(function(e){s.push(e)}),n[p].attrs||(n[p].attrs={}),Object.keys(r.attrs).forEach(function(e){null===r.attrs[e]?(n.removeAttribute(e),delete n[p].attrs[e]):n[p].attrs[e]!==r.attrs[e]&&(n.setAttribute(e,r.attrs[e]),n[p].attrs[e]=r.attrs[e]);var t=s.indexOf(e);-1<t&&s.splice(t,1)}),s.forEach(function(e){n.removeAttribute(e),delete n[p].attrs[e]});var a=[];if(n[p].props&&Object.keys(n[p].props).forEach(function(e){a.push(e)}),n[p].props||(n[p].props={}),Object.keys(r.props).forEach(function(e){null===r.props[e]?(n[e]=null,delete n[p].props[e]):n[p].props[e]!==r.props[e]&&(n[e]=r.props[e],n[p].props[e]=r.props[e]);var t=a.indexOf(e);-1<t&&a.splice(t,1)}),a.forEach(function(e){n[e]=null,delete n[p].props[e]}),r.children[0]&&r.children[0].key){var c={},u={};for(r.children.forEach(function(e){u[e.key]=e});n.firstChild;)c[n.firstChild[p].key]=n.removeChild(n.firstChild);r.children.forEach(function(e){c[e.key]?(n.appendChild(c[e.key]),S(c[e.key],e,o)):n.appendChild(P(e,o))})}else for(r.children.forEach(function(e,t){if(n.childNodes[t])S(n.childNodes[t],e,o);else{var r=P(e,o);n.appendChild(r),o[p].mounted&&r[p]&&r[p].id&&j(o[p].children[r[p].id])}});n.childNodes[r.children.length];){var d=n.childNodes[r.children.length];n.removeChild(d)}r.ref&&r.ref(n),r.key?n[p].key=r.key:n[p].key&&delete n[p].key;break;case h:n.nodeValue!==r&&(n.nodeValue=r)}}}var c=function(e){function i(){var e;_(this,i);for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];var o=a(this,(e=i.__proto__||Object.getPrototypeOf(i)).call.apply(e,[this].concat(r)));return o.name="MODESTE Error",o.message="[MODESTE ERROR] "+o.message,Error.captureStackTrace(o,i),o}return s(i,e),i}(Error);function U(e){if(e[p].render){e[p].mounted?b(e,"willUpdate"):b(e,"willMount");var t=e[p].render(r,i);if("object"!==(void 0===t?"undefined":C(t))||t.component||!t.tag)throw new c(e[p].name+": Component root must be a tag");e[p].dom?S(e[p].dom,t,e):e[p].dom=P(t,e),e[p].dom[p].id=e[p].id,e[p].mounted&&b(e,"didUpdate")}else b(e,"didUpdate")}function e(e,t){window.setImmediate(function(){e(),t&&t()})}var u=Promise.resolve();function M(e,t){return u.then(function(){e(),t&&t()})}function D(e,t){setTimeout(function(){e(),t&&t()},0)}var R=window.setImmediate?e:window.Promise?M:D,A=[],x={};function I(){A.forEach(function(e){x[e[p].id]||(U(e),x[e[p].id]=!0)}),A=[],x={}}function L(e,t){A.push(e),1===A.length&&R(I,t)}var V=function(){function u(t,e,r,n){var o=this;_(this,u);var i,s,a=k(),c=!1!==t.scope&&(t[p]?t[p].scope:E(k()));this[p]={},i=this,s=t,m.forEach(function(e){s[e]&&(i[p][e]=s[e].bind(i))}),b(this,"willCreate"),this[p].id=a,n&&(n[p].children[a]=this),this[p].name=e,this[p].factories={},this[p].parent=n,this[p].app=n?n[p].app:this,this[p].scope=c,this[p].children={},this[p].props=r||{},this[p].defaultProps=t.defaultProps,this[p].defaultProps&&(this[p].props=N({},this[p].defaultProps,this[p].props)),this[p].subscribers={},this[p].subscriptions=t.subscriptions?t.subscriptions:[],this[p].render=t.render?t.render.bind(this):null,this[p].shouldUpdateData=d,this[p].shouldUpdateProps=y,this[p].subscriptions.forEach(function(e){var t=e.store;e.fields.forEach(function(e){t[p].data.hasOwnProperty(e)&&(t[p].subscribers[e][a]=o)})}),t.props&&t.props.forEach(function(e){Object.defineProperty(o,e,{enumerable:!0,get:function(){return void 0!==this[p].props[e]&&null!==this[p].props[e]?this[p].props[e]:this[p].defaultProps[e]}})}),t.data&&(this[p].data=t.data.bind(this)(),Object.keys(this[p].data).forEach(function(r){o[p].subscribers[r]={},Object.defineProperty(o,r,{enumerable:!0,get:function(){return this[p].data[r]},set:function(e){if(this[p].shouldUpdateData(this[p].data[r],e)){this[p].data[r]=e,L(this);var t=this[p].subscribers[r];Object.keys(t).forEach(function(e){return L(t[e])})}}})})),t.components&&Object.keys(t.components).forEach(function(e){!function(e,t,n){if(!n[p]){var r=k(),o=!1!==n.scope&&E(r);n[p]={id:r,scope:o},n.style&&v(n.style(),o),w[r]=function(e,t,r){return new V(n,e,t,r)}}e[p].factories[t]=w[n[p].id]}(o,e,t.components[e])}),t.methods&&Object.keys(t.methods).forEach(function(e){o[e]=t.methods[e].bind(o)}),b(this,"didCreate")}return t(u,[{key:"$render",value:function(){U(this)}},{key:"$data",get:function(){return N({},this[p].data)},set:function(t){var r=this;Object.keys(t).forEach(function(e){void 0!==r[p].data&&(r[e]=t[e])})}},{key:"$props",get:function(){return N({},this[p].props)}},{key:"$app",get:function(){return this[p].app}},{key:"$dom",get:function(){return this[p].dom}}]),u}();return function(e){function n(e,t){_(this,n);var r=a(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,"modesteRoot",t));return r[p].isApp=!0,e.style&&v(e.style(),r[p].scope),r[p].wrap=e.selector?document.querySelector(e.selector):null,r.$render(),r}return s(n,V),t(n,[{key:"$render",value:function(){if(function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(n):void 0}(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"$render",this).call(this),this[p].render&&!this[p].mounted){if(!this[p].wrap)return j(this);for(;this[p].wrap.firstChild;)this[p].wrap.removeChild(this[p].wrap.firstChild);this[p].wrap.appendChild(this[p].dom),j(this)}}},{key:"$wrap",get:function(){return this[p].wrap}},{key:"$props",set:function(e){T(this,e)}}]),n}()}();
//# sourceMappingURL=modeste.browser.js.map
