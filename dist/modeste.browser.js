var Modeste=function(){"use strict";var n="modesteRoot",p="__modesteInternal",d=window.Node.COMMENT_NODE,f=window.Node.ELEMENT_NODE,u=window.Node.TEXT_NODE;function a(t,e){return t===e}function s(t,e){return!a(t,e)}function c(t,e){return!function(t,e){var r=Object.keys(t),o=Object.keys(e);if(r.length!==o.length)return!1;for(var n=0;n<r.length;n++){var i=r[n];if(o.indexOf(i)<0)return!1;if(!a(t[i],e[i]))return!1}return!0}(t,e)}var l=["willCreate","didCreate","willMount","didMount","willUpdate","didUpdate","willRemove","didRemove","shouldUpdateData","shouldUpdateProps"];function h(t,e){t[p][e]&&t[p][e]()}var i=1e12;function m(t,e){for(var r=void 0,o=void 0;o=r=r?r+Math.floor(35*Math.random()).toFixed(36):Math.floor(Math.random()*i).toString(36),e&&(o=e(r)),t[o];);return t[o]=!0,o}var t={};function v(e){return m(t,function(t){return"__"+e+"_"+t+"__"})}function y(t,e){if(t){var r=document.createElement("style");if(e){var o="."+e;r.textContent=t.replace(/:\$/gm,o)}else r.textContent=t;return document.head.appendChild(r),r}}function o(t,o,e){var n={},i={},a={tag:t,props:n,attrs:i};return o&&(o instanceof Array?e=o:Object.keys(o).forEach(function(t){switch(t[0]){case"_":i[(e=t.substr(1),r=e.replace(/([A-Z])/g,"-$1").toLowerCase(),"-"===r[0]?r.substr(1):r)]=o[t];break;case"$":a[t.substr(1)]=o[t];break;default:n[t]=o[t]}var e,r})),a.children=e||[],a}function b(t,e){var r={},o={component:t,props:r};return e&&Object.keys(e).forEach(function(t){switch(t[0]){case"$":o[t.substr(1)]=e[t];break;default:r[t]=e[t]}}),o}function O(t,e){t&&"string"!=typeof t&&e&&(t.component||(t.props.className||(t.props.className=""),t.attrs.class||(t.attrs.class=""),t.props.className=(t.props.className+" "+e).trim(),t.attrs.class=(t.attrs.class+" "+e).trim()))}function E(t,e,r){return r[p].factories[t]?r[p].factories[t](e,r):r[p].app.factories[t](e,r)}function w(t){var e=t[p].children;Object.keys(e).forEach(function(t){return w(e[t])}),t[p].mounted=!0,h(t,"didMount")}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function o(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),t}}(),r=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},_=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};function k(e,r){if(O(e,r[p].scope),!e)return document.createComment("");switch(void 0===e?"undefined":g(e)){case"string":return document.createTextNode(e);case"object":if(e.component){var t=E(e.component,e.props,r);return e.ref&&e.ref(t),T(t),t[p].dom}var o=document.createElement(e.tag);return o[p]={},o[p].attrs={},o[p].props={},Object.keys(e.attrs).forEach(function(t){null!==e.attrs[t]&&(o.setAttribute(t,e.attrs[t]),o[p].attrs[t]=e.attrs[t])}),Object.keys(e.props).forEach(function(t){null!==e.props[t]&&(o[t]=e.props[t],o[p].props[t]=e.props[t])}),e.children.forEach(function(t){var e=k(t,r);o.appendChild(e),r[p].mounted&&e[p]&&e[p].id&&w(r[p].children[e[p].id])}),e.ref&&e.ref(o),o}}function N(t,e,r){if(t[p]&&t[p].id){var o=t[p].id,n=r[p].children[o];if(e.props||(e.props={}),n[p].name===e.component)return n[p].dom=t,i=n,a=e.props,i[p].shouldUpdateProps(i.props,a)&&(i[p].props=a,T(i)),void(e.ref&&e.ref(n));r[p].removeChild(o)}var i,a,s=E(e.component,e.props,r);s[p].dom=t,e.ref&&e.ref(s),T(s),r[p].mounted&&w(s)}function C(o,r,n){if(O(r,n[p].scope),r&&r.component)N(o,r,n);else{if(e=o,!((i=r)?"object"===(void 0===i?"undefined":g(i))&&e.nodeType===f?i.tag.toUpperCase()===e.tagName:"string"==typeof i&&e.nodeType===u:e.nodeType===d)){o[p]&&o[p].id&&function e(t,r){if(t[p].children[r]){var o=t[p].children[r];h(o,"willRemove"),delete o[p].dom,Object.keys(o[p].children).forEach(function(t){e(t,o)}),h(o,"didRemove"),delete t[p].children[r]}}(n,o[p].id);var t=k(r,n);return o.parentNode.replaceChild(t,o),void(n[p].dom===o&&(n[p].dom=t))}var e,i;switch(o.nodeType){case f:var a=[];o[p].attrs&&Object.keys(o[p].attrs).forEach(function(t){a.push(t)}),o[p].attrs||(o[p].attrs={}),Object.keys(r.attrs).forEach(function(t){null===r.attrs[t]?(o.removeAttribute(t),delete o[p].attrs[t]):o[p].attrs[t]!==r.attrs[t]&&(o.setAttribute(t,r.attrs[t]),o[p].attrs[t]=r.attrs[t]);var e=a.indexOf(t);-1<e&&a.splice(e,1)}),a.forEach(function(t){o.removeAttribute(t),delete o[p].attrs[t]});var s=[];for(o[p].props&&Object.keys(o[p].props).forEach(function(t){s.push(t)}),o[p].props||(o[p].props={}),Object.keys(r.props).forEach(function(t){null===r.props[t]?(o[t]=null,delete o[p].props[t]):o[p].props[t]!==r.props[t]&&(o[t]=r.props[t],o[p].props[t]=r.props[t]);var e=s.indexOf(t);-1<e&&s.splice(e,1)}),s.forEach(function(t){o[t]=null,delete o[p].props[t]}),r.children||(r.children=[]),r.children.forEach(function(t,e){if(o.childNodes[e])C(o.childNodes[e],t,n);else{var r=k(t,n);o.appendChild(r),n[p].mounted&&r[p]&&r[p].id&&w(n[p].children[r[p].id])}});o.childNodes[r.children.length];){var c=o.childNodes[r.children.length];o.removeChild(c)}r.ref&&r.ref(o);break;case u:o.nodeValue!==r&&(o.nodeValue=r)}}}var M=function(t){function i(){var t;j(this,i);for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];var n=_(this,(t=i.__proto__||Object.getPrototypeOf(i)).call.apply(t,[this].concat(r)));return n.name="MODESTE Error",n.message="[MODESTE ERROR] "+n.message,Error.captureStackTrace(n,modesteError),n}return r(i,t),i}(Error);function T(t){var e=!t[p].dom;h(t,e?"willMount":"willUpdate");var r=t[p].render(o,b);if("object"!==(void 0===r?"undefined":g(r))||r.component||!r.tag)throw new M(t[p].name+": Component root must be a tag");e?t[p].dom=k(r,t):C(t[p].dom,r,t),t[p].dom[p].id=t[p].id,e||h(t,"didUpdate")}var P=function(){function i(e,t){var r,o,n=this;j(this,i),this[p]={},e.manifest.factories||(e.manifest.factories={}),this[p].factories=e.manifest.factories,this[p].parent=t,this[p].app=t?t[p].app:this,this[p].name=e.name,this[p].id=e.id,this[p].scope=e.scope,this[p].children={},this[p].props=e.props?e.props:{},this[p].render=e.manifest.render.bind(this),this[p].shouldUpdateData=s,this[p].shouldUpdateProps=c,r=this,o=e.manifest,l.forEach(function(t){o[t]&&(r[p][t]=o[t].bind(r))}),h(this,"willCreate"),e.manifest.data&&(this[p].data=e.manifest.data(),Object.keys(this[p].data).forEach(function(e){return Object.defineProperty(n,e,{enumerable:!0,get:function(){return this[p].data[e]},set:function(t){this[p].shouldUpdateData(this[p].data[e],t)&&(this[p].data[e]=t,T(this))}})})),e.manifest.components&&Object.keys(e.manifest.components).forEach(function(t){!function(t,n,i){if(!t[p].factories[n]){var a=!1!==i.scope&&v(n);y(i.style(),a),t[p].factories[n]=function(t,e){var r=m(e[p].children),o=new P({name:n,manifest:i,scope:a,id:r,props:t},e);return e[p].children[r]=o}}}(n,t,e.manifest.components[t])}),e.manifest.methods&&Object.keys(e.manifest.methods).forEach(function(t){n[t]=e.manifest.methods[t].bind(n)}),h(this,"didCreate")}return e(i,[{key:"render",value:function(){T(this)}},{key:"props",get:function(){return this[p].props}}]),i}(),S=v(n);return function(t){function o(t,e){j(this,o);var r=_(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,{name:n,id:n,manifest:t,props:e,scope:S}));return t.style&&y(t.style(),S),r[p].wrap=t.selector?document.querySelector(t.selector):null,r}return r(o,P),e(o,[{key:"render",value:function(){if(function t(e,r,o){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,r,o)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(o):void 0}(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"render",this).call(this),!this[p].mounted&&!this[p].wrap)return w(this);this[p].wrap&&0===this[p].wrap.childNodes.length&&(this[p].wrap.appendChild(this[p].dom),w(this))}},{key:"$dom",get:function(){return this[p].dom}}]),o}()}();
//# sourceMappingURL=modeste.browser.js.map
