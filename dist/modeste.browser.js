var Modeste=function(){"use strict";var n="modesteRoot",p="__modesteInternal",d=window.Node.COMMENT_NODE,f=window.Node.ELEMENT_NODE,u=window.Node.TEXT_NODE;function a(e,t){return e===t}function s(e,t){return!a(e,t)}function c(e,t){return!function(e,t){var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var o=0;o<r.length;o++){var i=r[o];if(n.indexOf(i)<0)return!1;if(!a(e[i],t[i]))return!1}return!0}(e,t)}var l=["willCreate","didCreate","willMount","didMount","willUpdate","didUpdate","willRemove","didRemove","shouldUpdateData","shouldUpdateProps"];function h(e,t){e[p][t]&&e[p][t]()}function m(e,t,r){for(var n=void 0;n=(Math.random()*e).toFixed(0),r&&(n=r(n)),t[n];);return t[n]=!0,n}var e={};function v(t){return m(1e6,e,function(e){return"__"+t+"_"+e+"__"})}function y(e,t){if(e){var r=document.createElement("style"),n="."+t;return r.textContent=e.replace(/:\$/gm,n),document.head.appendChild(r),r}}function o(e,t,r){var n={},o={},i={tag:e,props:n,attrs:o,children:r};return t&&Object.keys(t).forEach(function(e){switch(e[0]){case"_":o[e.substr(1)]=t[e];break;case"$":i[e.substr(1)]=t[e];break;default:n[e]=t[e]}}),i}function i(e,t){var r={},n={component:e,props:r};return t&&Object.keys(t).forEach(function(e){switch(e[0]){case"$":n[e.substr(1)]=t[e];break;default:r[e]=t[e]}}),n}function b(r,e){if(r&&"string"!=typeof r&&(r.children||(r.children=[]),r.props||(r.props={}),!r.component)){if(r.attrs){var n={};Object.keys(r.attrs).forEach(function(e){var t;n[(t=e,t.replace(/([A-Z])/g,"-$1").toLowerCase())]=r.attrs[e]}),r.attrs=n}else r.attrs={};r.props.className?(delete r.attrs.class,r.props.className=e+" "+r.props.className):r.attrs.class?r.attrs.class=e+" "+r.attrs.class:r.props.className=e}}function O(e,t,r){return r[p].factories[e]?r[p].factories[e](t,r):r[p].app.factories[e](t,r)}function E(e){var t=e[p].children;Object.keys(t).forEach(function(e){return E(t[e])}),e[p].mounted=!0,h(e,"didMount")}var w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),j=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},_=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t};function k(t,r){if(b(t,r[p].scope),!t)return document.createComment("");switch(void 0===t?"undefined":w(t)){case"string":return document.createTextNode(t);case"object":if(t.component){var e=O(t.component,t.props,r);return t.ref&&t.ref(e),M(e),e[p].dom}var n=document.createElement(t.tag);return n[p]={},n[p].attrs={},n[p].props={},Object.keys(t.attrs).forEach(function(e){null!==t.attrs[e]&&(n.setAttribute(e,t.attrs[e]),n[p].attrs[e]=t.attrs[e])}),Object.keys(t.props).forEach(function(e){null!==t.props[e]&&(n[e]=t.props[e],n[p].props[e]=t.props[e])}),t.children.forEach(function(e){var t=k(e,r);n.appendChild(t),r[p].mounted&&t[p]&&t[p].id&&E(r[p].children[id])}),t.ref&&t.ref(n),n}}function N(e,t,r){if(e[p]&&e[p].id){var n=e[p].id,o=r[p].children[n];if(t.props||(t.props={}),o[p].name===t.component)return o[p].dom=e,i=o,a=t.props,i[p].shouldUpdateProps(i.props,a)&&(i.props=a,render(i)),void(t.ref&&t.ref(o));r[p].removeChild(n)}var i,a,s=O(t.component,t.props,r);s[p].dom=e,t.ref&&t.ref(s),M(s),r[p].mounted&&E(s)}function C(n,r,o){if(b(r,o[p].scope),r&&r.component)N(n,r,o);else{if(t=n,!((i=r)?"object"===(void 0===i?"undefined":w(i))&&t.nodeType===f?i.tag.toUpperCase()===t.tagName:"string"==typeof i&&t.nodeType===u:t.nodeType===d)){n[p]&&n[p].id&&function t(e,r){if(e[p].children[r]){var n=e[p].children[r];h(n,"willRemove"),delete n[p].dom,Object.keys(n[p].children).forEach(function(e){t(e,n)}),h(n,"didRemove"),delete e[p].children[r]}}(o,n[p].id);var e=k(r,o);return n.parentNode.replaceChild(e,n),void(o[p].dom===n&&(o[p].dom=e))}var t,i;switch(n.nodeType){case f:var a=[];n[p].attrs&&Object.keys(n[p].attrs).forEach(function(e){a.push(e)}),n[p].attrs||(n[p].attrs={}),Object.keys(r.attrs).forEach(function(e){null===r.attrs[e]?(n.removeAttribute(e),delete n[p].attrs[e]):n[e]!==r.attrs[e]&&(n.setAttribute(e,r.attrs[e]),n[p].attrs[e]=r.attrs[e]);var t=a.indexOf(e);-1<t&&a.splice(t,1)}),a.forEach(function(e){n.removeAttribute(e),delete n[p].attrs[e]});var s=[];for(n[p].props&&Object.keys(n[p].props).forEach(function(e){s.push(e)}),n[p].props||(n[p].props={}),Object.keys(r.props).forEach(function(e){null===r.props[e]?(n[e]=null,delete n[p].props[e]):n[e]!==r.props[e]&&(n[e]=r.props[e],n[p].props[e]=r.props[e]);var t=s.indexOf(e);-1<t&&s.splice(t,1)}),s.forEach(function(e){n[e]=null,delete n[p].props[e]}),r.children||(r.children=[]),r.children.forEach(function(e,t){if(n.childNodes[t])C(n.childNodes[t],e,o);else{var r=k(e,o);n.appendChild(r),o[p].mounted&&r[p]&&r[p].id&&emitMount(o[p].children[id])}});n.childNodes[r.children.length];){var c=n.childNodes[r.children.length];n.removeChild(c)}r.ref&&r.ref(n);break;case u:n.nodeValue!==r&&(n.nodeValue=r)}}}var T=function(e){function i(){var e;g(this,i);for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];var o=_(this,(e=i.__proto__||Object.getPrototypeOf(i)).call.apply(e,[this].concat(r)));return o.name="MODESTE Error",o.message="[MODESTE ERROR] "+o.message,Error.captureStackTrace(o,modesteError),o}return j(i,e),i}(Error);function M(e){var t=!e[p].dom;h(e,t?"willMount":"willUpdate");var r=e[p].render(o,i);if("object"!==(void 0===r?"undefined":w(r))||r.component||!r.tag)throw new T(e[p].name+": Component root must be a tag");t?e[p].dom=k(r,e):C(e[p].dom,r,e),e[p].dom[p].id=e[p].id,t||h(e,"didUpdate")}var P=function(){function i(t,e){var r,n,o=this;g(this,i),this[p]={},t.manifest.factories||(t.manifest.factories={}),this[p].factories=t.manifest.factories,this[p].parent=e,this[p].app=e?e[p].app:this,this[p].name=t.name,this[p].id=t.id,this[p].scope=t.scope,this[p].children={},this[p].render=t.manifest.render.bind(this),this[p].shouldUpdateData=s,this[p].shouldUpdateProps=c,r=this,n=t.manifest,l.forEach(function(e){n[e]&&(r[p][e]=n[e].bind(r))}),h(this,"willCreate"),this.props=t.props?t.props:{},t.manifest.data&&(this[p].data=t.manifest.data(),Object.keys(this[p].data).forEach(function(t){return Object.defineProperty(o,t,{enumerable:!0,get:function(){return this[p].data[t]},set:function(e){this[p].shouldUpdateData(this[p].data[t],e)&&(this[p].data[t]=e,M(this))}})})),t.manifest.components&&Object.keys(t.manifest.components).forEach(function(e){!function(e,o,i){if(!e[p].factories[o]){var a=v(o);y(i.style(),a),e[p].factories[o]=function(e,t){var r=m(1e6,t[p].children),n=new P({name:o,manifest:i,scope:a,id:r,props:e},t);return t[p].children[r]=n}}}(o,e,t.manifest.components[e])}),t.manifest.methods&&Object.keys(t.manifest.methods).forEach(function(e){o[e]=t.manifest.methods[e].bind(o)}),h(this,"didCreate")}return t(i,[{key:"render",value:function(){M(this)}}]),i}(),U=v(n);return function(e){function r(e){g(this,r);var t=_(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,{name:n,id:n,manifest:e,scope:U}));return e.style&&y(e.style(),U),t[p].wrap=document.querySelector(e.selector),t}return j(r,P),t(r,[{key:"render",value:function(){(function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0})(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"render",this).call(this),0===this[p].wrap.childNodes.length&&(this[p].wrap.appendChild(this[p].dom),E(this))}}]),r}()}();
//# sourceMappingURL=modeste.browser.js.map
