!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Modeste=t()}(this,function(){"use strict";function s(e,t){return e===t}function a(e,t){if(e){var r=document.createElement("style"),o="."+t,n="."+i(t);return r.textContent=e.replace(/:scoped/gm,o).replace(/:component/gm,n),document.head.appendChild(r),r}}function i(e){return"_"+e}function c(e,t,r){for(var o=void 0;o=(Math.random()*e).toFixed(0),r&&(o=r(o)),t[o];);return t[o]=!0,o}var t="modesteRoot",p="__modesteInternal",f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e){function i(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);for(var t=arguments.length,r=Array(t),o=0;o<t;o++)r[o]=arguments[o];var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e=i.__proto__||Object.getPrototypeOf(i)).call.apply(e,[this].concat(r)));return n.name="MODESTE Error",n.message="[MODESTE ERROR] "+n.message,Error.captureStackTrace(n,modesteError),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,Error),i}();function d(t,r,e){if(!t)return document.createComment("");switch(void 0===t?"undefined":f(t)){case"string":return document.createTextNode(t);case"object":if(h(t,r[p].scope,e),t.component){var o=l(t.component,t.props,r);return t.ref&&t.ref(o),E(o),o[p].dom}var n=document.createElement(t.tag);return n[p]={},n[p].attrs={},n[p].props={},Object.keys(t.attrs).forEach(function(e){null!==t.attrs[e]&&(n.setAttribute(e,t.attrs[e]),n[p].attrs[e]=t.attrs[e])}),Object.keys(t.props).forEach(function(e){null!==t.props[e]&&(n[e]=t.props[e],n[p].props[e]=t.props[e])}),t.children.forEach(function(e){m(e,r),n.appendChild(d(e,r))}),t.ref&&t.ref(n),n}}function u(r,o,n,e){if(h(o,n[p].scope,e),o&&o.component)!function(e,t,r){if(e[p].id){var o=e[p].id,n=r[p].children[o];if(t.props||(t.props={}),n[p].name===t.component)return n[p].dom=e,i=n,s=t.props,i[p].shouldUpdateProps(i.props,s)&&(i.props=s,E(i)),t.ref&&t.ref(n);r[p].removeChild(o)}var i,s;var a=l(t.component,t.props,r);a[p].dom=e,t.ref&&t.ref(a);E(a)}(r,o,n);else{if(!function(e,t){if(!t)return 8===e.nodeType;{if("object"===(void 0===t?"undefined":f(t))&&1===e.nodeType)return t.tag.toUpperCase()===e.tagName;if("string"==typeof t&&3===e.nodeType)return!0}return!1}(r,o)){r[p]&&r[p].id&&function t(e,r){if(e[p].children[r]){var o=this[p].children[r];O(o,"willRemove"),delete o[p].dom,Object.keys(o[p].children).forEach(function(e){t(e,o)}),O(o,"didRemove"),delete e[p].children[r]}}(n[p],r[p].id);var t=d(o,n);return r.parentNode.replaceChild(t,r),void(n[p].dom===r&&(n[p].dom=t))}switch(r.nodeType){case 1:var i=[];r[p].attrs&&Object.keys(r[p].attrs).forEach(function(e){i.push(e)}),r[p].attrs||(r[p].attrs={}),Object.keys(o.attrs).forEach(function(e){null===o.attrs[e]?(r.removeAttribute(e),delete r[p].attrs[e]):r[e]!==o.attrs[e]&&(r.setAttribute(e,o.attrs[e]),r[p].attrs[e]=o.attrs[e]);var t=i.indexOf(e);-1<t&&i.splice(t,1)}),i.forEach(function(e){r.removeAttribute(e),delete r[p].attrs[e]});var s=[];for(r[p].props&&Object.keys(r[p].props).forEach(function(e){s.push(e)}),r[p].props||(r[p].props={}),Object.keys(o.props).forEach(function(e){null===o.props[e]?(r[e]=null,delete r[p].props[e]):r[e]!==o.props[e]&&(r[e]=o.props[e],r[p].props[e]=o.props[e]);var t=s.indexOf(e);-1<t&&s.splice(t,1)}),s.forEach(function(e){r[e]=null,delete r[p].props[e]}),o.children||(o.children=[]),o.children.forEach(function(e,t){m(e,n),r.childNodes[t]?u(r.childNodes[t],e,n):r.appendChild(d(e,n))});r.childNodes[o.children.length];){var a=r.childNodes[o.children.length];r.removeChild(a)}o.ref&&o.ref(r);break;case 3:r.nodeValue!==o&&(r.nodeValue=o)}}}function l(e,t,r){return r[p].factories[e]?r[p].factories[e](t,r):r[p].app.factories[e](t,r)}function h(r,e,t){if(r&&"string"!=typeof r&&(r.children||(r.children=[]),r.props||(r.props={}),!r.component)){if(r.attrs){var o={};Object.keys(r.attrs).forEach(function(e){var t;o[(t=e,t.replace(/([A-Z])/g,"-$1").toLowerCase())]=r.attrs[e]}),r.attrs=o}else r.attrs={};var n=t?i(e):e;r.props.className?(delete r.attrs.class,r.props.className=n+" "+r.props.className):r.attrs.class?r.attrs.class=n+" "+r.attrs.class:r.props.className=n}}function m(e,t){if(e){if("string"!=typeof e&&!e.tag&&!e.component)throw new o(t[p].name+': VDOM node must be a string or an object with "tag" or "component" property');if(e.children&&!(e.children instanceof Array))throw new o(t[p].name+': VDOM node "children" property must be an Array')}}var y=["willCreate","didCreate","willMount","didMount","willUpdate","didUpdate","willRemove","didRemove","shouldUpdateData","shouldUpdateProps"],e={};function b(t,e){var r,o,n=this;this[p]={},t.manifest.factories||(t.manifest.factories={}),this[p].factories=t.manifest.factories,this[p].app=e||this,this[p].name=t.name,this[p].id=t.id,this[p].scope=t.scope,this[p].children={},this[p].render=t.manifest.render.bind(this),this[p].shouldUpdateData=w,this[p].shouldUpdateProps=g,r=this,o=t.manifest,y.forEach(function(e){o[e]&&(r[p][e]=o[e].bind(r))}),O(this,"willCreate"),this.props=t.props?t.props:{},t.manifest.data&&(this[p].data=t.manifest.data(),Object.keys(this[p].data).forEach(function(t){return Object.defineProperty(n,t,{enumerable:!0,get:function(){return this[p].data[t]},set:function(e){this[p].shouldUpdateData(this[p].data[t],e)&&(this[p].data[t]=e,E(this))}})})),t.manifest.components&&Object.keys(t.manifest.components).forEach(function(e){!function(e,n,i){if(!e[p].factories[n]){var s=v(n);a(i.style(),s),e[p].factories[n]=function(e,t){var r=c(1e4,t[p].children),o=new b({name:n,manifest:i,scope:s,id:r,props:e},t[p].app);return t[p].children[r]=o}}}(n,e,t.manifest.components[e])}),t.manifest.methods&&Object.keys(t.manifest.methods).forEach(function(e){n[e]=t.manifest.methods[e].bind(n)}),O(this,"didCreate")}function v(t){return c(1e4,e,function(e){return t+e})}function E(e){var t=!e[p].dom;O(e,t?"willMount":"willUpdate");var r=e[p].render();if("object"!==(void 0===r?"undefined":f(r))||r.component||!r.tag)throw new o(e[p].name+": Component root must be a tag");t?e[p].dom=d(r,e,!0):u(e[p].dom,r,e,!0),e[p].dom[p].id=e[p].id,O(e,t?"didMount":"didUpdate")}function O(e,t){e[p][t]&&e[p][t]()}function w(e,t){return!s(e,t)}function g(e,t){!function(e,t){var r=Object.keys(e),o=Object.keys(t);if(r.length!==o.length)return;for(var n=0;n<r.length;n++){var i=r[n];if(o.indexOf(i)<0)return;if(!s(e[i],t[i]))return}}(e,t)}b.prototype.render=function(){E(this)};var r=v(t);function n(e){b.call(this,{name:t,id:t,manifest:e,scope:r}),e.style&&a(e.style(),r),this[p].wrap=document.querySelector(e.selector)}return((n.prototype=Object.create(b.prototype)).constructor=n).prototype.render=function(){b.prototype.render.call(this),0===this[p].wrap.childNodes.length&&this[p].wrap.appendChild(this[p].dom)},n});
//# sourceMappingURL=modeste.browser.js.map
