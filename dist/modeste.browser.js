var Modeste=function(){"use strict";var p="__modesteInternal",f=window.Node.COMMENT_NODE,l=window.Node.ELEMENT_NODE,h=window.Node.TEXT_NODE;function u(t,e){return t!==e}function y(t,e){return!function(t,e){var r=Object.keys(t),o=Object.keys(e);if(r.length!==o.length)return!1;for(var n=0;n<r.length;n++){var i=r[n];if(o.indexOf(i)<0)return!1;if(t[i]!==e[i])return!1}return!0}(t,e)}var m=["willCreate","didCreate","willMount","didMount","willUpdate","didUpdate","willRemove","didRemove","shouldUpdateData","shouldUpdateProps"];function v(t,e){t[p][e]&&t[p][e]()}function b(t,e){if(t){var r=document.createElement("style");if(e){var o="."+e+"$1";r.textContent=t.replace(/:scoped([^\w\d])/gm,o)}else r.textContent=t;return document.head.appendChild(r),r}}var o=8,n=0;function k(t){var e=Math.random().toString(36).substr(2,o),r=e+"0".repeat(o-e.length)+(n++).toString(36);return t?t(r):r}function E(t){return"__"+t+"__"}var w={};function r(t,o,e){var n={},i={},s={tag:t,props:n,attrs:i};return o&&(o instanceof Array?e=o:Object.keys(o).forEach(function(t){switch(t[0]){case"_":i[(e=t.substr(1),r=e.replace(/([A-Z])/g,"-$1").toLowerCase(),"-"===r[0]?r.substr(1):r)]=o[t];break;case"$":s[t.substr(1)]=o[t];break;default:n[t]=o[t]}var e,r})),s.children=e||[],s}function i(t,e){var r={},o={component:t,props:r};return e&&Object.keys(e).forEach(function(t){switch(t[0]){case"$":o[t.substr(1)]=e[t];break;default:r[t]=e[t]}}),o}function O(t,e){t&&"string"!=typeof t&&!t.component&&e&&(t.props.className||(t.props.className=""),t.attrs.class||(t.attrs.class=""),t.props.className=(t.props.className+" "+e).trim(),t.attrs.class=(t.attrs.class+" "+e).trim())}function g(t,e,r){return r[p].factories[t](t,e,r)}function j(t){var e=t[p].children;Object.keys(e).forEach(function(t){return j(e[t])}),t[p].mounted=!0,v(t,"didMount")}var C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function o(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),t}}(),s=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};function P(e,r){if(r&&O(e,r[p].scope),!e)return document.createComment("");switch(void 0===e?"undefined":C(e)){case"string":return document.createTextNode(e);case"object":if(e.component){var t=g(e.component,e.props,r);return e.ref&&e.ref(t),M(t),void 0!==e.key&&(t[p].dom[p].key=e.key),t[p].dom}var o=document.createElement(e.tag);return o[p]={},o[p].attrs={},o[p].props={},Object.keys(e.attrs).forEach(function(t){null!==e.attrs[t]&&(o.setAttribute(t,e.attrs[t]),o[p].attrs[t]=e.attrs[t])}),Object.keys(e.props).forEach(function(t){null!==e.props[t]&&(o[t]=e.props[t],o[p].props[t]=e.props[t])}),e.children.forEach(function(t){var e=P(t,r);o.appendChild(e),r&&r[p].mounted&&e[p]&&e[p].id&&j(r[p].children[e[p].id])}),e.ref&&e.ref(o),void 0!==e.key&&(o[p].key=e.key),o}}function N(){for(var r=arguments,t=function(e){Object.keys(r[e]).forEach(function(t){r[0][t]=r[e][t]})},e=1;e<arguments.length;e++)t(e);return arguments[0]}function T(t,e){var r=t[p].defaultProps?N({},t[p].defaultProps,e):e;t[p].shouldUpdateProps(t[p].props,r)&&(t[p].props=r,M(t))}function $(t){v(t,"willRemove");var e=t[p].parent,r=t[p].id;Object.keys(t[p].children).forEach(function(t){$(t)}),t[p].subscriptions.forEach(function(t){var e=t.store;t.fields.forEach(function(t){e[p].data.hasOwnProperty(t)&&delete e[p].subscribers[t][r]})}),t[p].mounted=!1,delete t[p].dom,e&&delete e[p].children[r],v(t,"didRemove")}function S(r,o,n){if(o&&o.component)!function(t,e,r){if(t[p]&&t[p].id){var o=t[p].id,n=r[p].children[o];if(n[p].name===e.component)return n[p].dom=t,T(n,e.props),e.ref&&e.ref(n);$(r[p].children[o])}var i=g(e.component,e.props,r);i[p].dom=t,e.ref&&e.ref(i),M(i),void 0!==e.key?i[p].dom[p].key=e.key:void 0!==i[p].dom[p].key&&delete i[p].dom[p].key,r[p].mounted&&j(i)}(r,o,n);else{if(e=r,!((i=o)?"object"===(void 0===i?"undefined":C(i))&&e.nodeType===l?i.tag.toUpperCase()===e.tagName:"string"==typeof i&&e.nodeType===h:e.nodeType===f)){r[p]&&r[p].id&&$(n[p].children[r[p].id]);var t=P(o,n);return r.parentNode.replaceChild(t,r),void(n&&n[p].dom===r&&(n[p].dom=t))}var e,i;switch(n&&O(o,n[p].scope),r.nodeType){case l:var s=[];r[p].attrs&&Object.keys(r[p].attrs).forEach(function(t){s.push(t)}),r[p].attrs||(r[p].attrs={}),Object.keys(o.attrs).forEach(function(t){null===o.attrs[t]?(r.removeAttribute(t),delete r[p].attrs[t]):r[p].attrs[t]!==o.attrs[t]&&(r.setAttribute(t,o.attrs[t]),r[p].attrs[t]=o.attrs[t]);var e=s.indexOf(t);-1<e&&s.splice(e,1)}),s.forEach(function(t){r.removeAttribute(t),delete r[p].attrs[t]});var a=[];if(r[p].props&&Object.keys(r[p].props).forEach(function(t){a.push(t)}),r[p].props||(r[p].props={}),Object.keys(o.props).forEach(function(t){null===o.props[t]?(r[t]=null,delete r[p].props[t]):r[p].props[t]!==o.props[t]&&(r[t]=o.props[t],r[p].props[t]=o.props[t]);var e=a.indexOf(t);-1<e&&a.splice(e,1)}),a.forEach(function(t){r[t]=null,delete r[p].props[t]}),o.children[0]&&void 0!==o.children[0].key){var c={},d={};for(o.children.forEach(function(t){d[t.key]=t});r.firstChild;)c[r.firstChild[p].key]=r.removeChild(r.firstChild);o.children.forEach(function(t){c[t.key]?(r.appendChild(c[t.key]),S(c[t.key],t,n)):U(t,r,n)})}else for(o.children.forEach(function(t,e){r.childNodes[e]?S(r.childNodes[e],t,n):U(t,r,n)});r.childNodes[o.children.length];){var u=r.childNodes[o.children.length];r.removeChild(u)}o.ref&&o.ref(r),o.key?r[p].key=o.key:r[p].key&&delete r[p].key;break;case h:r.nodeValue!==o&&(r.nodeValue=o)}}}function U(t,e,r){var o=P(t,r);e.appendChild(o),r&&r[p].mounted&&o[p]&&o[p].id&&j(r[p].children[o[p].id])}var c=function(t){function i(){var t;_(this,i);for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];var n=a(this,(t=i.__proto__||Object.getPrototypeOf(i)).call.apply(t,[this].concat(r)));return n.name="MODESTE Error",n.message="[MODESTE ERROR] "+n.message,Error.captureStackTrace(n,i),n}return s(i,t),i}(Error);function M(t){if(t[p].render){t[p].mounted?v(t,"willUpdate"):v(t,"willMount");var e=t[p].render(r,i);if("object"!==(void 0===e?"undefined":C(e))||e.component||!e.tag)throw new c(t[p].name+": Component root must be a tag");t[p].dom?(t[p].dom[p]&&void 0!==t[p].dom[p].key&&(e.key=t[p].dom[p].key),S(t[p].dom,e,t)):t[p].dom=P(e,t),t[p].dom[p].id=t[p].id,t[p].mounted&&v(t,"didUpdate")}else v(t,"didUpdate")}function t(t,e){window.setImmediate(function(){t(),e&&e()})}var d=Promise.resolve();function D(t,e){return d.then(function(){t(),e&&e()})}function R(t,e){setTimeout(function(){t(),e&&e()},0)}var A=window.setImmediate?t:window.Promise?D:R,x=[],I={};function L(){x.forEach(function(t){I[t[p].id]||(M(t),I[t[p].id]=!0)}),x=[],I={}}function V(t,e){x.push(t),1===x.length&&A(L,e)}var q=function(){function d(e,t,r,o){var n=this;_(this,d);var i,s,a=k(),c=!1!==e.scope&&(e[p]?e[p].scope:E(k()));this[p]={},i=this,s=e,m.forEach(function(t){s[t]&&(i[p][t]=s[t].bind(i))}),v(this,"willCreate"),this[p].id=a,o&&(o[p].children[a]=this),this[p].name=t,this[p].factories={},this[p].parent=o,this[p].app=o?o[p].app:this,this[p].scope=c,this[p].children={},this[p].props=r||{},this[p].defaultProps=e.defaultProps,this[p].defaultProps&&(this[p].props=N({},this[p].defaultProps,this[p].props)),this[p].subscribers={},this[p].subscriptions=e.subscriptions?e.subscriptions:[],this[p].render=e.render?e.render.bind(this):null,this[p].shouldUpdateData=u,this[p].shouldUpdateProps=y,this[p].subscriptions.forEach(function(t){var e=t.store;t.fields.forEach(function(t){e[p].data.hasOwnProperty(t)&&(e[p].subscribers[t][a]=n)})}),e.props&&e.props.forEach(function(t){Object.defineProperty(n,t,{enumerable:!0,get:function(){return void 0!==this[p].props[t]&&null!==this[p].props[t]?this[p].props[t]:this[p].defaultProps[t]}})}),e.data&&(this[p].data=e.data.bind(this)(),Object.keys(this[p].data).forEach(function(r){n[p].subscribers[r]={},Object.defineProperty(n,r,{enumerable:!0,get:function(){return this[p].data[r]},set:function(t){if(this[p].shouldUpdateData(this[p].data[r],t)){this[p].data[r]=t,V(this);var e=this[p].subscribers[r];Object.keys(e).forEach(function(t){return V(e[t])})}}})})),e.components&&Object.keys(e.components).forEach(function(t){!function(t,e,o){if(!o[p]){var r=k(),n=!1!==o.scope&&E(r);o[p]={id:r,scope:n},o.style&&b(o.style(),n),w[r]=function(t,e,r){return new q(o,t,e,r)}}t[p].factories[e]=w[o[p].id]}(n,t,e.components[t])}),e.methods&&Object.keys(e.methods).forEach(function(t){n[t]=e.methods[t].bind(n)}),v(this,"didCreate")}return e(d,[{key:"$render",value:function(){M(this)}},{key:"$data",get:function(){return N({},this[p].data)},set:function(e){var r=this;Object.keys(e).forEach(function(t){void 0!==r[p].data&&(r[t]=e[t])})}},{key:"$props",get:function(){return N({},this[p].props)}},{key:"$app",get:function(){return this[p].app}},{key:"$dom",get:function(){return this[p].dom}}]),d}();return function(t){function o(t,e){_(this,o);var r=a(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t,"modesteRoot",e));return r[p].isApp=!0,t.style&&b(t.style(),r[p].scope),r[p].wrap=t.selector?document.querySelector(t.selector):null,r.$render(),r}return s(o,q),e(o,[{key:"$render",value:function(){if(function t(e,r,o){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,r,o)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(o):void 0}(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"$render",this).call(this),this[p].render&&!this[p].mounted){if(!this[p].wrap)return j(this);for(;this[p].wrap.firstChild;)this[p].wrap.removeChild(this[p].wrap.firstChild);this[p].wrap.appendChild(this[p].dom),j(this)}}},{key:"$wrap",get:function(){return this[p].wrap}},{key:"$props",set:function(t){T(this,t)}}]),o}()}();
//# sourceMappingURL=modeste.browser.js.map
