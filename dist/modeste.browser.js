var Modeste=function(){"use strict";var o="modesteRoot",u="__modesteInternal",f=window.Node.COMMENT_NODE,l=window.Node.ELEMENT_NODE,h=window.Node.TEXT_NODE;function s(e,t){return e===t}function a(e,t){return!s(e,t)}function c(e,t){return!function(e,t){var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var o=0;o<r.length;o++){var i=r[o];if(n.indexOf(i)<0)return!1;if(!s(e[i],t[i]))return!1}return!0}(e,t)}var d=["willCreate","didCreate","willMount","didMount","willUpdate","didUpdate","willRemove","didRemove","shouldUpdateData","shouldUpdateProps"];function m(e,t){e[u][t]&&e[u][t]()}var n=6,i=0;function p(e){var t=Math.random().toString(36).substr(2,n),r=t+"0".repeat(n-t.length)+(i++).toString(36);return e?e(r):r}function y(t){return p(function(e){return t+"_"+e})}function v(e,t){if(e){var r=document.createElement("style");if(t){var n="."+t;r.textContent=e.replace(/:\$/gm,n)}else r.textContent=e;return document.head.appendChild(r),r}}function b(e,n,t){var o={},i={},s={tag:e,props:o,attrs:i};return n&&(n instanceof Array?t=n:Object.keys(n).forEach(function(e){switch(e[0]){case"_":i[(t=e.substr(1),r=t.replace(/([A-Z])/g,"-$1").toLowerCase(),"-"===r[0]?r.substr(1):r)]=n[e];break;case"$":s[e.substr(1)]=n[e];break;default:o[e]=n[e]}var t,r})),s.children=t||[],s}function k(e,t){var r={},n={component:e,props:r};return t&&Object.keys(t).forEach(function(e){switch(e[0]){case"$":n[e.substr(1)]=t[e];break;default:r[e]=t[e]}}),n}function w(e,t){e&&"string"!=typeof e&&t&&(e.component||(e.props.className||(e.props.className=""),e.attrs.class||(e.attrs.class=""),e.props.className=(e.props.className+" "+t).trim(),e.attrs.class=(e.attrs.class+" "+t).trim()))}function E(e,t,r){return r[u].factories[e]?r[u].factories[e](t,r):r[u].app.factories[e](t,r)}function O(e){var t=e[u].children;Object.keys(t).forEach(function(e){return O(t[e])}),e[u].mounted=!0,m(e,"didMount")}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),r=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},C=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t};function _(t,r){if(w(t,r[u].scope),!t)return document.createComment("");switch(void 0===t?"undefined":g(t)){case"string":return document.createTextNode(t);case"object":if(t.component){var e=E(t.component,t.props,r);return t.ref&&t.ref(e),$(e),t.key&&(e[u].dom[u].key=t.key),e[u].dom}var n=document.createElement(t.tag);return n[u]={},n[u].attrs={},n[u].props={},Object.keys(t.attrs).forEach(function(e){null!==t.attrs[e]&&(n.setAttribute(e,t.attrs[e]),n[u].attrs[e]=t.attrs[e])}),Object.keys(t.props).forEach(function(e){null!==t.props[e]&&(n[e]=t.props[e],n[u].props[e]=t.props[e])}),t.children.forEach(function(e){var t=_(e,r);n.appendChild(t),r[u].mounted&&t[u]&&t[u].id&&O(r[u].children[t[u].id])}),t.ref&&t.ref(n),t.key&&(n[u].key=t.key),n}}function N(e,t){e[u].shouldUpdateProps(e[u].props,t)&&(e[u].props=t,$(e))}function T(n,r,o){if(w(r,o[u].scope),r&&r.component)!function(e,t,r){if(e[u]&&e[u].id){var n=e[u].id,o=r[u].children[n];if(o[u].name===t.component)return o[u].dom=e,N(o,t.props),t.ref&&t.ref(o),t.key?o[u].dom[u].key=t.key:o[u].dom[u].key&&delete o[u].dom[u].key;r[u].removeChild(n)}var i=E(t.component,t.props,r);i[u].dom=e,t.ref&&t.ref(i),$(i),t.key?i[u].dom[u].key=t.key:i[u].dom[u].key&&delete i[u].dom[u].key,r[u].mounted&&O(i)}(n,r,o);else{if(t=n,!((i=r)?"object"===(void 0===i?"undefined":g(i))&&t.nodeType===l?i.tag.toUpperCase()===t.tagName:"string"==typeof i&&t.nodeType===h:t.nodeType===f)){n[u]&&n[u].id&&function t(e,r){if(e[u].children[r]){var n=e[u].children[r];m(n,"willRemove"),delete n[u].dom,Object.keys(n[u].children).forEach(function(e){t(e,n)}),m(n,"didRemove"),delete e[u].children[r]}}(o,n[u].id);var e=_(r,o);return n.parentNode.replaceChild(e,n),void(o[u].dom===n&&(o[u].dom=e))}var t,i;switch(n.nodeType){case l:var s=[];n[u].attrs&&Object.keys(n[u].attrs).forEach(function(e){s.push(e)}),n[u].attrs||(n[u].attrs={}),Object.keys(r.attrs).forEach(function(e){null===r.attrs[e]?(n.removeAttribute(e),delete n[u].attrs[e]):n[u].attrs[e]!==r.attrs[e]&&(n.setAttribute(e,r.attrs[e]),n[u].attrs[e]=r.attrs[e]);var t=s.indexOf(e);-1<t&&s.splice(t,1)}),s.forEach(function(e){n.removeAttribute(e),delete n[u].attrs[e]});var a=[];if(n[u].props&&Object.keys(n[u].props).forEach(function(e){a.push(e)}),n[u].props||(n[u].props={}),Object.keys(r.props).forEach(function(e){null===r.props[e]?(n[e]=null,delete n[u].props[e]):n[u].props[e]!==r.props[e]&&(n[e]=r.props[e],n[u].props[e]=r.props[e]);var t=a.indexOf(e);-1<t&&a.splice(t,1)}),a.forEach(function(e){n[e]=null,delete n[u].props[e]}),r.children[0]&&r.children[0].key){var c={},d={};for(r.children.forEach(function(e){d[e.key]=e});n.firstChild;)c[n.firstChild[u].key]=n.removeChild(n.firstChild);r.children.forEach(function(e){c[e.key]?(n.appendChild(c[e.key]),T(c[e.key],e,o)):n.appendChild(_(e,o))})}else for(r.children.forEach(function(e,t){if(n.childNodes[t])T(n.childNodes[t],e,o);else{var r=_(e,o);n.appendChild(r),o[u].mounted&&r[u]&&r[u].id&&O(o[u].children[r[u].id])}});n.childNodes[r.children.length];){var p=n.childNodes[r.children.length];n.removeChild(p)}r.ref&&r.ref(n),r.key?n[u].key=r.key:n[u].key&&delete n[u].key;break;case h:n.nodeValue!==r&&(n.nodeValue=r)}}}var P=function(e){function i(){var e;j(this,i);for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];var o=C(this,(e=i.__proto__||Object.getPrototypeOf(i)).call.apply(e,[this].concat(r)));return o.name="MODESTE Error",o.message="[MODESTE ERROR] "+o.message,Error.captureStackTrace(o,modesteError),o}return r(i,e),i}(Error);function $(e){var t=!e[u].dom;m(e,t?"willMount":"willUpdate");var r=e[u].render(b,k,e[u].props);if("object"!==(void 0===r?"undefined":g(r))||r.component||!r.tag)throw new P(e[u].name+": Component root must be a tag");t?e[u].dom=_(r,e):T(e[u].dom,r,e),e[u].dom[u].id=e[u].id,t||m(e,"didUpdate")}var e=void 0,S=void 0;window.setImmediate?e=window.setImmediate:window.Promise?(S=Promise.resolve(),e=function(e){S.then(e)}):e=function(e){setTimeout(e,0)};var M=e,U={},A=!0;function D(e,t){U[e[u].id]||(U[e[u].id]=e),A&&(A=!1,M(function(){Object.keys(U).forEach(function(e){(U[e][u].isApp||U[e][u].parent.mounted)&&$(U[e])}),U={},A=!0,t&&t()}))}var R=function(){function i(t,e){var r,n,o=this;j(this,i),this[u]={},t.manifest.factories||(t.manifest.factories={}),this[u].factories=t.manifest.factories,this[u].parent=e,this[u].app=e?e[u].app:this,this[u].name=t.name,this[u].id=t.id,this[u].scope=t.scope,this[u].children={},this[u].props=t.props?t.props:{},this[u].render=t.manifest.render.bind(this),this[u].shouldUpdateData=a,this[u].shouldUpdateProps=c,r=this,n=t.manifest,d.forEach(function(e){n[e]&&(r[u][e]=n[e].bind(r))}),m(this,"willCreate"),t.manifest.data&&(this[u].data=t.manifest.data(),Object.keys(this[u].data).forEach(function(t){return Object.defineProperty(o,t,{enumerable:!0,get:function(){return this[u].data[t]},set:function(e){this[u].shouldUpdateData(this[u].data[t],e)&&(this[u].data[t]=e,D(this))}})})),t.manifest.components&&Object.keys(t.manifest.components).forEach(function(e){!function(e,o,i){if(!e[u].factories[o]){var s=!1!==i.scope&&y(o);i.style&&v(i.style(),s),e[u].factories[o]=function(e,t){var r=p(),n=new R({name:o,manifest:i,scope:s,id:r,props:e},t);return t[u].children[r]=n}}}(o,e,t.manifest.components[e])}),t.manifest.methods&&Object.keys(t.manifest.methods).forEach(function(e){o[e]=t.manifest.methods[e].bind(o)}),m(this,"didCreate")}return t(i,[{key:"$render",value:function(){$(this)}},{key:"$data",get:function(){return this[u].data}},{key:"$props",get:function(){return this[u].props}},{key:"$app",get:function(){return this[u].app}},{key:"$dom",get:function(){return this[u].dom}}]),i}(),x=y(o);return function(e){function n(e,t){j(this,n);var r=C(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{name:o,id:o,manifest:e,props:t,scope:x}));return r[u].parent=null,r[u].isApp=!0,e.style&&v(e.style(),x),r[u].wrap=e.selector?document.querySelector(e.selector):null,r.$render(),r}return r(n,R),t(n,[{key:"$render",value:function(){if(function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(n):void 0}(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"$render",this).call(this),!this[u].mounted&&!this[u].wrap)return O(this);this[u].wrap&&0===this[u].wrap.childNodes.length&&(this[u].wrap.appendChild(this[u].dom),O(this))}},{key:"$wrap",get:function(){return this[u].wrap}},{key:"$props",set:function(e){N(this,e)}}]),n}()}();
//# sourceMappingURL=modeste.browser.js.map
