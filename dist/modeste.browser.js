var Modeste=function(){"use strict";var e="modesteRoot",c="__modesteInternal";function a(t,e){return t===e}function i(t,e,r){for(var n=void 0;n=(Math.random()*t).toFixed(0),r&&(n=r(n)),e[n];);return e[n]=!0,n}var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=function(t){function s(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(t=s.__proto__||Object.getPrototypeOf(s)).call.apply(t,[this].concat(r)));return o.name="MODESTE Error",o.message="[MODESTE ERROR] "+o.message,Error.captureStackTrace(o,modesteError),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(s,Error),s}();function f(t,e){if(t){var r=document.createElement("style"),n="."+e;return r.textContent=t.replace(/:\$/gm,n),document.head.appendChild(r),r}}function d(e,r){if(!e)return document.createComment("");switch(void 0===e?"undefined":p(e)){case"string":return document.createTextNode(e);case"object":if(h(e,r[c].scope),e.component){var t=l(e.component,e.props,r);return e.ref&&e.ref(t),E(t),t[c].dom}var n=document.createElement(e.tag);return n[c]={},n[c].attrs={},n[c].props={},Object.keys(e.attrs).forEach(function(t){null!==e.attrs[t]&&(n.setAttribute(t,e.attrs[t]),n[c].attrs[t]=e.attrs[t])}),Object.keys(e.props).forEach(function(t){null!==e.props[t]&&(n[t]=e.props[t],n[c].props[t]=e.props[t])}),e.children.forEach(function(t){m(t,r),n.appendChild(d(t,r))}),e.ref&&e.ref(n),n}}function u(r,n,o){if(h(n,o[c].scope),n&&n.component)!function(t,e,r){if(t[c]&&t[c].id){var n=t[c].id,o=r[c].children[n];if(e.props||(e.props={}),o[c].name===e.component)return o[c].dom=t,s=o,a=e.props,s[c].shouldUpdateProps(s.props,a)&&(s.props=a,E(s)),e.ref&&e.ref(o);r[c].removeChild(n)}var s,a;var i=l(e.component,e.props,r);i[c].dom=t,e.ref&&e.ref(i);E(i)}(r,n,o);else{if(!function(t,e){if(!e)return 8===t.nodeType;{if("object"===(void 0===e?"undefined":p(e))&&1===t.nodeType)return e.tag.toUpperCase()===t.tagName;if("string"==typeof e&&3===t.nodeType)return!0}return!1}(r,n)){r[c]&&r[c].id&&function e(t,r){if(t[c].children[r]){var n=t[c].children[r];O(n,"willRemove"),delete n[c].dom,Object.keys(n[c].children).forEach(function(t){e(t,n)}),O(n,"didRemove"),delete t[c].children[r]}}(o,r[c].id);var t=d(n,o);return r.parentNode.replaceChild(t,r),void(o[c].dom===r&&(o[c].dom=t))}switch(r.nodeType){case 1:var s=[];r[c].attrs&&Object.keys(r[c].attrs).forEach(function(t){s.push(t)}),r[c].attrs||(r[c].attrs={}),Object.keys(n.attrs).forEach(function(t){null===n.attrs[t]?(r.removeAttribute(t),delete r[c].attrs[t]):r[t]!==n.attrs[t]&&(r.setAttribute(t,n.attrs[t]),r[c].attrs[t]=n.attrs[t]);var e=s.indexOf(t);-1<e&&s.splice(e,1)}),s.forEach(function(t){r.removeAttribute(t),delete r[c].attrs[t]});var a=[];for(r[c].props&&Object.keys(r[c].props).forEach(function(t){a.push(t)}),r[c].props||(r[c].props={}),Object.keys(n.props).forEach(function(t){null===n.props[t]?(r[t]=null,delete r[c].props[t]):r[t]!==n.props[t]&&(r[t]=n.props[t],r[c].props[t]=n.props[t]);var e=a.indexOf(t);-1<e&&a.splice(e,1)}),a.forEach(function(t){r[t]=null,delete r[c].props[t]}),n.children||(n.children=[]),n.children.forEach(function(t,e){m(t,o),r.childNodes[e]?u(r.childNodes[e],t,o):r.appendChild(d(t,o))});r.childNodes[n.children.length];){var e=r.childNodes[n.children.length];r.removeChild(e)}n.ref&&n.ref(r);break;case 3:r.nodeValue!==n&&(r.nodeValue=n)}}}function l(t,e,r){return r[c].factories[t]?r[c].factories[t](e,r):r[c].app.factories[t](e,r)}function h(r,t){if(r&&"string"!=typeof r&&(r.children||(r.children=[]),r.props||(r.props={}),!r.component)){if(r.attrs){var n={};Object.keys(r.attrs).forEach(function(t){var e;n[(e=t,e.replace(/([A-Z])/g,"-$1").toLowerCase())]=r.attrs[t]}),r.attrs=n}else r.attrs={};r.props.className?(delete r.attrs.class,r.props.className=t+" "+r.props.className):r.attrs.class?r.attrs.class=t+" "+r.attrs.class:r.props.className=t}}function m(t,e){if(t){if("string"!=typeof t&&!t.tag&&!t.component)throw new n(e[c].name+': VDOM node must be a string or an object with "tag" or "component" property');if(t.children&&!(t.children instanceof Array))throw new n(e[c].name+': VDOM node "children" property must be an Array')}}function o(t,e,r){var n={},o={},s={tag:t,props:n,attrs:o,children:r};return e&&Object.keys(e).forEach(function(t){switch(t[0]){case"_":o[t.substr(1)]=e[t];break;case"$":s[t.substr(1)]=e[t];break;default:n[t]=e[t]}}),s}function s(t,e){var r={},n={component:t,props:r};return e&&Object.keys(e).forEach(function(t){switch(t[0]){case"$":n[t.substr(1)]=e[t];break;default:r[t]=e[t]}}),n}var y=["willCreate","didCreate","willMount","didMount","willUpdate","didUpdate","willRemove","didRemove","shouldUpdateData","shouldUpdateProps"],t={};function b(e,t){var r,n,o=this;this[c]={},e.manifest.factories||(e.manifest.factories={}),this[c].factories=e.manifest.factories,this[c].app=t||this,this[c].name=e.name,this[c].id=e.id,this[c].scope=e.scope,this[c].children={},this[c].render=e.manifest.render.bind(this),this[c].shouldUpdateData=w,this[c].shouldUpdateProps=g,r=this,n=e.manifest,y.forEach(function(t){n[t]&&(r[c][t]=n[t].bind(r))}),O(this,"willCreate"),this.props=e.props?e.props:{},e.manifest.data&&(this[c].data=e.manifest.data(),Object.keys(this[c].data).forEach(function(e){return Object.defineProperty(o,e,{enumerable:!0,get:function(){return this[c].data[e]},set:function(t){this[c].shouldUpdateData(this[c].data[e],t)&&(this[c].data[e]=t,E(this))}})})),e.manifest.components&&Object.keys(e.manifest.components).forEach(function(t){!function(t,o,s){if(!t[c].factories[o]){var a=v(o);f(s.style(),a),t[c].factories[o]=function(t,e){var r=i(1e6,e[c].children),n=new b({name:o,manifest:s,scope:a,id:r,props:t},e[c].app);return e[c].children[r]=n}}}(o,t,e.manifest.components[t])}),e.manifest.methods&&Object.keys(e.manifest.methods).forEach(function(t){o[t]=e.manifest.methods[t].bind(o)}),O(this,"didCreate")}function v(e){return i(1e6,t,function(t){return e+t})}function E(t){var e=!t[c].dom;O(t,e?"willMount":"willUpdate");var r=t[c].render(o,s);if("object"!==(void 0===r?"undefined":p(r))||r.component||!r.tag)throw new n(t[c].name+": Component root must be a tag");e?t[c].dom=d(r,t):u(t[c].dom,r,t),t[c].dom[c].id=t[c].id,O(t,e?"didMount":"didUpdate")}function O(t,e){t[c][e]&&t[c][e]()}function w(t,e){return!a(t,e)}function g(t,e){!function(t,e){var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return;for(var o=0;o<r.length;o++){var s=r[o];if(n.indexOf(s)<0)return;if(!a(t[s],e[s]))return}}(t,e)}b.prototype.render=function(){E(this)};var r=v(e);function j(t){b.call(this,{name:e,id:e,manifest:t,scope:r}),t.style&&f(t.style(),r),this[c].wrap=document.querySelector(t.selector)}return((j.prototype=Object.create(b.prototype)).constructor=j).prototype.render=function(){b.prototype.render.call(this),0===this[c].wrap.childNodes.length&&this[c].wrap.appendChild(this[c].dom)},j}();
//# sourceMappingURL=modeste.browser.js.map
